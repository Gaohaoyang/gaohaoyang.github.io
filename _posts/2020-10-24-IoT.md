---
layout: post
title:  "物联网研发-Development for IoT"
date:   2020-10-24 20:30:00
categories: 技术工具
tags: Web HTTP MQTT IoT 物联网 智能家居 5G 智能音箱 纳什均衡 ZigBee adb otg 手机
author : 鹤啸九天
excerpt: 物联网&智能家居相关知识点
mathjax: true
---

* content
{:toc}

# 总结

- 2019年6月，贝壳就成立了一只硬件团队Ke IoT Lab，主要围绕人、房、店三大核心数据触点，并在当年推出了智能硬件产品“贝刻手环”
- 2020年11月发布了升级款产品“贝刻手环Air”，一款面向房产经纪从业人员的智能手环产品。
- 【2021-7-7】[贝壳发布智能家居品牌,让家装公司产品升级更高效](https://t.cj.sina.com.cn/articles/view/7504419610/1bf4c5b1a00100u6ow)

## 视频资源

- 法国智能家居控制嘲讽视频：[youtube主页](https://www.youtube.com/c/REMA1000/videos)
  - （1）拔牙后，开门，SMARTHUS Det enkle er ofte det beste REMA 1000。[经典开门版](https://www.youtube.com/watch?v=sgJLpuprQp8)，[开门片刻摄像头画面](https://www.youtube.com/watch?v=N9IxPoXOKXM)，[壁炉摄像头画面](https://www.youtube.com/watch?v=wsu95iA8oU4)；[调温度](https://www.youtube.com/watch?v=tsBK13YBs2s)，[语音叫车car takeway](https://www.youtube.com/watch?v=JeP8IJvAaE0)，[打开冰箱门](https://www.youtube.com/watch?v=fgjKijkGewo)，[冰箱摄像头画面](https://www.youtube.com/watch?v=EM2uWGJ3sqk)，[冰箱常规开启对比](https://www.youtube.com/watch?v=9D-s40VmHB0)，[Smoothie果汁](https://www.youtube.com/watch?v=GBhO5_eu9Ew)
  - [圣诞老人面部识别失败，无法送礼物](https://www.youtube.com/watch?v=j8D1wBAUPQ4)
  - [SMARTBOAT – ENGLISH VERSION 游艇生活智能控制](https://www.youtube.com/watch?v=6MzmIUwFzds)
  - Tredemølla-Smarthus II，[跑步机健身](https://www.youtube.com/watch?v=SADTqhe_c5s)，[片段](https://www.youtube.com/watch?v=vxj2wUdxoN0)（水果广告），[跑步摔倒](https://www.youtube.com/watch?v=-E9vx_CEr1M)；[VR全景跑步](https://www.youtube.com/watch?v=hg8t8Crv4Wg)；Spinach & Celery Detox Shot，[喝果汁](https://www.youtube.com/watch?v=ET2Iu9kAZx8)；[B12 Shot开灯](https://www.youtube.com/watch?v=moXeP9i-jjU)；


## 物联网行业

【2017-11-4】[智能家居是未来物联网成长的关键](https://zhuanlan.zhihu.com/p/30773693)：报告《互联世界：智能家居是未来物联网成长的关键》指出，截至今年年底，近200亿个物联网和联网设备将在全球被部署，未来四年将会再增加100亿。企业近年来一直是物联网使用的关键市场，但长期预测表明，2020年代智能家居将可能成为联网和物联网设备部署增长的主要驱动力，连接数将会达到500亿。

该报告的关键研究发现包括：
- 1、作为部署的联网/IoT设备份额的一部分，智能家居设备将在2021年超过智能手机
- 2、2017年物联网将增长17%，但2021年，年增长率将下降至9%
- 3、企业物联网目前占总联网/物联网终端市场存量的52%

### 物联网未来发展趋势分析

物联网正成为经济社会绿色、智能、可持续发展的关键基础和重要引擎。随着物联网技术产品的不断成熟，物联网的潜力和成长性正逐步凸显，应用将加速渗透到生产和生活各个环节，市场规模不断扩大；产业潜力将加快释放，市场化的资源配置机制逐步确立;物联网与传统产业的深度融合将加剧，并带来生产方式和生活方式的深刻变革。
- （1）物联网与移动互联网**融合**方向市场潜力空间巨大
  - 移动互联网与物联网是最具发展潜力的两大信息通信产业：移动互联网主要面向个人消费者市场，侧重于提供大众消费性、全球性的服务；而物联网主要侧重于行业性、区域性的服务。
  - 当前，移动互联网正进入高速普及期，成功的产品和服务模式不断向其它产业领域延伸渗透，而处于起步阶段的物联网，也开始融入移动互联网元素，移动互联网与物联网的结合成为物联网发展最有市场潜力和创新空间的方向。
- （2）**M2M**、**车联网**市场最具内生动力，商业化发展更加成熟
  - 市场需求、成本、标准化、技术成熟度、商业模式是影响物联网应用规模化推广的主要因素，M2M和车联网市场内生动力强大，相关技术标准日趋成熟，全面推广的各方面条件基本具备，将成为物联网应用的率先突破方向。
- （3）**行业应用**仍将持续稳步发展，蕴含巨大提升空间
  - 行业应用仍然是物联网发展的重要领域。在工业、农业、电力、交通、物流、安防、环保等行业领域，物联网应用提升的空间广阔。
- （4）**万物互联**时代全面开启
  - 全球互联网连接增长步入动力转换阶段。全球互联网正从“**人人**相联”向“**万物**互联”迈进，物联网作为互联网的网络延伸和应用拓展，实现对物理世界的感知识别、实时控制、精确管理和科学决策。
  - 在消费领域，融合互联网与物联网特征的智能可穿戴设备快速普及，预计2016年全球出货量将增长38.2%，达到1.1亿；
  - 在生产领域，Forrester调查表明33%的企业已经或计划部署物联网解决方案，25%的企业则已经开展评估；
  - 在城市管理领域，物联网成为智慧城市核心要素，在公共安全、城市交通、管网监测等方面取得广泛应用。
  - 从未来发展前景看，物联网市场规模巨大。2016年，美国和西欧的物联网投入资金将分别达到2320亿元和1450亿元，预期至2020年物联网营收规模增速分别达到16.1%和18.9%。据麦肯锡预测，2025年物联网对全球经济贡献将达到11.1万亿元，占全球GDP总量的11%。


# IoT 物联网

- [物联网及MQTT协议概述](https://zhuanlan.zhihu.com/p/89057819)
- B站视频[三分钟了解物联网概念](https://www.bilibili.com/video/BV1Sb411E7Wh/)，[什么是物联网](https://www.bilibili.com/video/BV1y44115719/)，[物联网是如何工作的](https://www.bilibili.com/video/BV14W411a7g9)
    - <iframe src="//player.bilibili.com/player.html?aid=46814591&bvid=BV1Sb411E7Wh&cid=82000363&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height="600" width="100%"> </iframe>
    - <iframe src="//player.bilibili.com/player.html?aid=53270227&bvid=BV1y44115719&cid=93198464&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height="600" width="100%"> </iframe>
    - <iframe src="//player.bilibili.com/player.html?aid=16778419&bvid=BV14W411a7g9&cid=27414361&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height="600" width="100%"> </iframe>

## 1. 什么是IoT

- **IoT**全称The Internet of Things，直译过来就是：**物体的Internet网络**，也就是**物联网**。
  - 物联网概念最早出现于比尔盖茨1995年《未来之路》，但受限于当时的硬件、网络以及传感设备，此时的IoT尚处于概念阶段。
  - 2005年11月17日，在突尼斯举行的信息社会世界峰会（WSIS）上，国际电信联盟（ITU）发布了《ITU互联网报告2005：物联网》，正式提出了“物联网”的概念。
- 关于物联网的百度百科定义如下：
>**物联网**是指通过各种信息传感器、射频识别技术（RFID）、全球定位系统、红外感应器、激光扫描器等各种装置与技术，实时采集任何需要监控、 连接、互动的物体或过程，采集其声、光、热、电、力学、化 学、生物、位置等各种需要的信息，通过各类可能的网络接入，实现物与物、物与人的泛在连接，实现对物品和过程的智能化感知、识别和管理。
两层含义：
- 一是其核心和基础仍然是互联网，是在互联网基础上的延伸和扩展的网络;
- 二是其用户端延伸和扩展到了任何物品与物品之间，进行信息交换和通信。

物联网与互联网的区别
- **互联网**：人们需要先去收集信息，并上传到互联网上，才能浏览。人在其中需要做大量工作，并难以动态地了解其变化。
- **物联网**：通过在物体上植入各种微型感应芯片、借助无线通信网络，与互联网相连接，可以让物体自己"说话"，不仅人可以与物体"对话"，物体与物体之间也能"交流"。

总结：
- 物联网是一个基于互联网、传统电信网等的信息承载体，它让所有能够被独立寻址的普通物理对象形成互联互通的网络。
- 物联网的本质核心是物与物、人与物之间的信息交互，物联网就是对物与物之间的连接、人与物之间的连接提供解决方式的，通过整体感知、可靠传输和智能处理，完成业务闭环。
- 运用MQTT协议，设备可以很方便地连接到物联网云服务，管理设备并处理数据，最后应用到各种业务场景
![](https://pic2.zhimg.com/80/5811e1ae665bafcd8cd900abf934c109_720w.png)

- 【2019-04-12】[产品视角：AIOT的趋势与终局](http://www.woshipm.com/pd/2208253.html/comment-page-1)
- 【2021-7-18】[谈谈IoT的过去、现在与未来](https://www.toutiao.com/i6985738835569148424/)
物联网技术的发展打破了以单一设备为主体的设计，在以往的交互设计中，我们的业务目标是围绕着人来设计的，我们的设计对象是单一的屏幕，无论是PC时代的客户端和web设计，还是移动时代的APP设计，我们的交互空间都仅限于可显示区域内的互动设计。

[img](https://p6-tt.byteimg.com/origin/pgc-image/SdOFLdR3G8AFgH?from=pc) ![](https://p6-tt.byteimg.com/origin/pgc-image/SdOFLdR3G8AFgH?from=pc)

## 物联网应用

事实上，物联网的应用已经十分广泛，遍及公共安全、交通管理、军事国防、环境保护、能源电力、工业监测、物流管理、医疗健康、智能家居等多个领域。目前物联网技术应用比较普及的几个行业是智能家居、智能交通和智能工厂，智能家居是 IoT 行业里面离用户最近的细分市场，以下是几个比较典型的应用场景。

[img](https://p6-tt.byteimg.com/origin/pgc-image/SdOFL3g28mtG52?from=pc) ![](https://p6-tt.byteimg.com/origin/pgc-image/SdOFL3g28mtG52?from=pc)

### 1）全屋智能
 
智能家居是离普通用户比较近的一种场景了，也是现在IoT行业发展最为蓬勃的行业之一，包括海尔、小米、华为等一众厂商都有所布局。
 
[img](https://p3-tt.byteimg.com/origin/pgc-image/SdOFL4D5AZhJPU?from=pc) ![谈谈IoT的过去、现在与未来](https://p3-tt.byteimg.com/origin/pgc-image/SdOFL4D5AZhJPU?from=pc)
 
图源网络
 
### 2）共享领域
 
在共享单车大爆发的2016年，IoT技术在共享领域全面铺开。
 
很有意思的是，共享单车解锁方式的发展，恰好也浓缩了IoT技术的发展。
 
### 3）智能音响
 
智能音响领域是一个神仙打架的领域，最早的Amazon Echo，再到苹果的HomePod，谷歌的Google Home，国内阿里的天猫精灵、百度的小度音响、小米的小爱音响等等。
 
为何这些软件属性比较强的巨头都进军这个行业呢？因为这涉及到下一代人机交互入口——语音交互，再加上各个巨头本身对于智能语音分析有着深入的研究，包括苹果的siri、Amazon Echo背后的Alexa，以及小米的小爱同学，都是属于智能语音技术比较成熟的产品。而这些产品的落地，需要一个硬件载体，这个载体就是智能音响。
 
随着IoT技术的发展，智能音响从刚开始的简单功能进化成个人助理（Personal Assistant），比如通过物联网技术连接扫地机器人等智能家居，就可以通过智能音响来控制智能家居的行为。
 
### 4）自动驾驶
 
当我们在畅想未来的时候，我们一般会将目光聚焦于衣食住行，而在城市越来越大，对出行效率的需求的越来越高的当下，自动驾驶正是一个火热的赛道。
 
我们很早就知道谷歌、百度等软件厂商已经在测试自动驾驶技术了，特斯拉的出现像一条鲶鱼，彻底带动了软件厂商的智能驾驶落地化和传统汽车厂商的转型。一方面，随着节能减排的人类大愿景的落实，新能源汽车如雨后春笋般出现，同时，这些汽车厂商也或多或少涉足了自动驾驶的领域。
 
![谈谈IoT的过去、现在与未来](https://p6-tt.byteimg.com/origin/pgc-image/SdOFL4sIOdoque?from=pc)
 
自动驾驶之所以未全面铺开，是因为其对于安全的要求极其苛刻，近些年发生过很多特斯拉车主手脱离方向盘使用Autopilot而发生的事故，为了避免此类事故的发生，汽车身上的传感器也在不断的进化中。
 
没有传感器，就不存在自动驾驶汽车，现在主流的自动驾驶汽车采用的传感器多为摄像头、雷达和激光雷达。通过这些传感器，获取车辆行驶信息，大量的数据不断积累保存在云端，通过机器学习等人工智能手段不断改进训练模型，从而完善自动驾驶的体验。


## 2. 物联网发展的问题与瓶颈

### 技术标准的统一与协调
- 目前，**传统互联网的标准并不适合物联网**。物联网感知层的数据多源异构，不同的设备有不同的接口，不同的技术标准；网络层、应用层也由于使用的网络类型不同、行业的应用方向不同而存在不同的网络协议和体系结构。建立的统一的物联网体系架构，统一的技术标准是物联网现在正在面对的难题

### 碎片化

由于终端设备的多样化，物联网的开发和应用存在较严重的碎片化问题，主要体现在以下几个方面：
- （1）**电气接口**的碎片化
  - 传统电气接口分为模拟信号、数字信号的传输模式，数字信号又有无数种通讯协议，所以电器接口访问问题给处理器编程带来了繁重任务，集成化的通讯模块的电气接口也同样存在问题；
- （2）终端传感器的**访问协议**碎片化
  - 每个传感器的配置、访问方式和通讯协议均不同，也需要进行重复的编程和配置；
- （3）终端通讯**接入方式**碎片化
  - 物联网终端可能是**有线**网络接入或者**总线**接入，也可能**无线**网络接入，而无线网络接入协议众多，如近距离的**蓝牙**、**超宽带**，中距离的**zigbee** WIFI，还有传统广域的2G 4G接入。还有近年来兴起的Lora、NB-IoT等；
- （4）**处理器**碎片化
  - 处理器纷繁复杂，对应不同的处理器，需要进行不同的板级配置，没有统一标准的板级硬件；
- （5）物联网**平台**的碎片化
  - 由于物联网到终端的通讯协议没有统一，物联网平台传输协议各不相同，传入不同的云服务器需要进行重复的编程工作。

## 3、物联网分层结构

STM32硬件开发属于节点层的开发，属于物联网硬件开发；
![](https://pic2.zhimg.com/80/v2-4e0a5a76546a660ee25545ffb047107d_720w.jpg)

开发物联网硬件的“物”的特性：
- （1）低成本
- （2）资源受限
- （3）电池与能耗
- （4）网络环境不稳定
- （5）网络安全不稳定
- （6）工作环境不稳定
- （7）传递数据量小

如何实现上述“物”的特性：
- （1）新型物联网通讯协议
- （2）轻量级协议栈
- （3）硬件低功耗设计
- （4）一定的安全性

## 4、目前物联网三大通讯协议

![](https://pic4.zhimg.com/80/v2-29383cceaacfb9277248ad6019cd819b_720w.jpg)


## 5、物联网安全

![](https://pic1.zhimg.com/80/v2-e449d5552715f32cf5475b559016ba88_720w.jpg)

物联网被劫持的几种情况,这些情况就要求我们：
- a、在云端方面应该做好设备的认证、授权，同时做好用户认证及用户权限管理；
- b、在传输过程中应该建立好具有安全认证的数据通道，数据校验及服务器认证，如有必要，需加设密钥证书等验证方式
- c、在硬件方面STM32读保护、MPU、防火墙等功能的应用

# AIoT 智联网

【2019-06-05】[从AIOT说起，谈谈智能家居](https://www.huxiu.com/article/302729.html)

**物联网**(Internet of things)已经呼喊了很多年，最终落地的却只是加了**联网模块的家庭设备**，相比传统式设备的唯一好处只是可以在APP上远程控制设备，亦或是可以定时触发设备。

通过公式“**（新体验-旧体验）-替换成本**” 可以计算新产品的价值，IOT设备的体验提升仅增加了云端手动控制，体验提升非常有限，因此一直不温不火。

**智联网**(AIOT，是AI + IOT的结合) 2018年开始崛起，核心是能够运用大量传感设备，综合语音、视觉、动作、温度等数据，实现IOT设备的全自然化的人机交互。

**智能音箱**是AIOT初期的的典型代表，2018年出货量达到2200万台，智能音箱为IOT的启示是语音交互，但是智能音箱一阵风刮过之后，后面AIOT该何去何从? 笔者从产品角度触发从两条线分析AIOT的发展趋势：
- **交互**方式：语音触发→传感触发→主动触发
- **协作**方式：单机交互→场景联动→多模态协同

## 阶段一：语音触发与单端智能

AIOT的第一阶段聚焦于**单一设备**，并且赋予设备听和说的能力，智能音箱是该阶段最有名的产物。典型的应用场景是通过远程拾音，实现对设备的操控，例如：“播放音乐”、“开灯、关灯”，相比APP操控，语音操控更加实时便捷。

但是，并不是什么设备都适合语音化，笔者从使用**频次**和功能**复杂度**出发，得出：
- 电视（盒子、遥控器）、投影仪、音箱、面板语音化价值较高
- 空调、冰箱、咖啡机、空气净化器次之。
![](http://image.woshipm.com/wp-files/2019/04/CB5TEiagUYmQFfUOhzlc.png)
 
## 阶段二：传感触发与多端联动
 
### 传感触发
 
语音触发相比手动触发方便程度有明显提升，但是在一些场景下依然不是很方便，试想夜晚下班回到家，大部分人是不想说话的。

因此，大家开始思考触发方式上有没有比语音触发更便捷的方式？结果就是**传感器**触发，通过**红外**传感器可以识别人体经过，通过**温度**传感器识别温度变化，通过**摄像头**识别人脸、动作和姿势等等。通过传感器可以实现初级的主动互动，效率更高，更便捷。

典型场景：
*  夜晚起夜：客厅和卫生间根据传感器识别到移动人体，直接开灯。
*  酒店：一段时间检测不到房间有人，关闭所有电器节约用电。
*  教育：摄像头智能检测儿童坐姿，坐姿不正确通过语音进行提示。
 
### 场景联动
 
第一阶段的控制是基于单设备的，但是随着家庭智能设备的增多，用户很多需求是多任务并且跨设备的。
- 例如：早上开灯的同时期望把空调也打开，打开电视的同时期望把窗帘关闭。

场景联动的目的就是围绕用户场景，多任务同步或异步自动执行，共同满足用户诉求。

典型场景：
*  早晨场景：睡醒后，口令”早安”，打开窗帘，打开空调，播报时间、今日天气，然后播放适合晨间收听的音乐。
*  回家场景：回家打开门的瞬间，灯光打开、音箱播报欢迎语或者留言、空调调整到合适的温度、热水器打开，电视打开并播放正在追的剧。

不同场景的用户需求强度：  
![](http://image.woshipm.com/wp-files/2019/04/ZxuC8r5fdQ0grTLtdlhp.png)  
在阶段二，无论是用户效率和便利度已经有一个跨越式提升，但是还是存在一些问题：
*  交互模式虽然无需用户开口，智能化程度已然很高，但是对用户情感上的关怀尚未体现。
*  场景联动打破了多智能设备之间的信息鸿沟，但是仍然停留在指令的串行或者并行执行阶段，多设备间的协同仍未得到深度体现。
 
## 阶段三：主动交互与多模态协同

当设备能够对用户主动发起关怀，并且可以将家庭智能设备打散重构，协同完成更复杂的任务，我们就进入了第三阶段。
 
### 主动互动

我们对人工智能的畅想，希望它是有温度的，其中一个很重要的方面就是可以主动互动，当然这里有个很重要的前提是不打扰。
想做到不打扰的主动互动，需要有充分的的用户画像，知道用户喜好，知道用户在空间中所处的方位，知道用户此时此刻的需求，然后给与精准的关怀。

典型场景：
- 通过传感器感知用户要出门，通过声纹感知用户好像生病了，通过云端知道今天要下雨。在用户要出门的时候主动提醒说”今天天气不好，记得带伞，身体不舒服要及时去看下医生”
 
### 多模态协同

**多模态**（MultiChannel）协同指的是围绕同一场景，通过将多种设备的输入方式和输出方式打通，实现多设备协同或场景迁移。多模态协同与多端联动的差别是**多端联动**的最小单元是**设备**，**多模态协同**的最小单元是**通道**(Channel)。

举个例子：智能音箱是一个设备，但是有2个Channel，分别是麦克风和扬声器，电视有2个Channel，分别是扬声器和显示屏。将设备的Channel拆开然后重构会发现IOT的交互能力边界会被大大延展，语音、视觉、触屏、手势，甚至你的「表情」，有哪些设备，哪种方式更舒服、自然，都可以用来满足你的需求。

典型场景：
- *话费充值*：当用户看电视时，用户欠费通知下发（利用电视的显示Channel），将欠费信息投放到电视上。通过智能音箱（利用音箱的扬声器Channel）播报欠费信息，用户通过音箱（利用音箱的麦克风Channel）直接发起缴费请求，然后将付费信息推送到手机上（利用手机的显示Channel）直接支付。
- *客人来访*：当门外有客人来访时，摄像头自动将来访的者的画面投放到电视上（利用电视的显示屏Channel），然后通过最近的音箱（利用音箱的扬声器Channel）播放有人来访的通知，用户可以对最近的智能音箱（利用音箱的麦克风Channel）发起指令开门或者与来访者进行语音对话。

![](http://image.woshipm.com/wp-files/2019/04/093ZzPGck9h2rpj324rG.png)

我们认为：主动互动和多模态协同是AIOT当前可预见到的终局体验，而且即将到来。
那么，目前在能力储备上需要储备哪些能力呢？
1.  边缘计算与离线指令：IOT设备往后发展一定会面临安全问题，例如被远程操控家庭的摄像头、热水器、电视等，一个解决方案就是做设备端的边缘计算，通过离线指令技术在本地识别用户意图并进行本地执行。
2.  多模态协同标准：构建多模态的标准协议，使得加入该标准的智能设备不仅可以共享状态和信息，还可以通过云端下发对所有Channel的控制。
3.  空间感知与仲裁：感知用户的所在位置，用最恰当的设备（仲裁）进行回应用户需求。
4.  AI与IoT的结合已经成为了趋势发展的必然，内部拆解来看会经过语音触发和单端智能、传感触发和多端智能、主动交互和多模态协同3个阶段。  
![](http://image.woshipm.com/wp-files/2019/04/xiJaZRo6CvuSUaLDnyw9.png)

# 智能家居

## 发展阶段

智能家居是一个非常火爆热门的物联网行业，自从苹果发布了**Homekit**和谷歌收购**Nest**之后，将智能家居彻底引爆。
智能家居行业，按照物物连接可以分为3个阶段：**单品连接**、**物物联动**、**平台集成**；目前智能家居行业正处于第二阶段。

### 第一阶段：单品连接 —— 单纯的物人连接

这个阶段涌现了非常多的单品，这类单品更乐意被叫做**智能硬件**而非单品。在智能单品时代，小米是佼佼者。
- 产品：以小米为例，小米先后推出了小蚁摄像头、小米门窗磁、小米报警器、小米音箱、小米灯泡；其它厂商有推出空气球（预报天气）。

这个阶段智能家居的粘性是非常低的，最开始的新鲜感会在使用几次之后慢慢消失。
- 常见的单品有：智能灯、智能门锁、智能音箱、智能插座、智能冰箱、智能窗帘、智能洗衣机、智能空调、智能插座、智能电饭煲、智能扫地机器人。
这个阶段是单纯的物人相连。

### 第二阶段：物物联动

在这个阶段中，企业整合自己旗下所有的单品，使得各产品之间能够联动。比如当智能门锁正常打开后灯自动亮起之类。

除了企业自身整合外，智能家居的集成商可以利用某个企业的开放平台，将其它第三方产品整合到该企业的平台中，并未最终用户提供定制化的联动场景。这个阶段在某些厂商、集成商的努力下，达成了部分物物相连。
- 比如A厂商下的所有单品都能够集成到某个APP下，或者某个集成商能够将多个公司的产品整合到一个系统下。前者以小米为主的，它的APP能够控制小米旗下大部分单品。后者是以欧瑞博、Control4等厂商的集成商为代表，将他们旗下的单品和其它公司的单品整合到他们开发的系统中。

### 第三阶段：平台集成

根据统一的标准， 使各企业单品能相互兼容， 目前还没有发展到这个阶段。即A公司的网关能够控制B公司的灯，C公司的传感器能够指挥D公司的扫地机器人打扫卫生。

这个阶段是要求万物互联，真正的连接，不是依赖于某个集成商或者某个厂商，而是通过某个协议完成了万物互联。
目前并没有一种通用的协议或者平台能够完成万物互联或者智能家居产品的互联。Wi-Fi和蓝牙虽然是全球共用的，但是由于自身原因还不能一统江湖（前者功耗高、支持的设备有限；后者是最近才支持mesh网络，还未普及）。
需要注意的是，单品和物物联动并非是严格按时间顺序推进的。当我刚入行时，已经存在物物联动的智能家居系统，而之后才有小米将智能硬件带到一个新的热度。

## 国内智能家居现状

【2019-06-05】目前国内的智能家居市场是两极分化：**厂商热用户冷**
- 智能家居厂商这边是热闹非凡，地产公司、家电公司、互联网公司和AI公司纷纷进入到这个行业；但是消费者这边，却冷清了很多。
- 相关数据显示，目前欧美国家智能家居的渗透率已超过35%，日本和韩国的渗透率超过25%，而在中国，这个数字还未达到5%。

消费者：难决策、价格高、消费者难接触、不智能
厂商：厂家分为以小米为代表的智能硬件/单品出身（先做单品，然后做一个超级APP管理所有单品，再进化成系统）和以欧瑞博为代表的以智能家居系统厂商（自建系统/平台，然后对接第三方厂家产品）。

智能家居未来
1. **多模态**：智能家居与其它AIOT行业不一样的地方是要求多模态的交互方式和多模态的协作（物物之间）。
  - 柒灵：所谓多模态交互即多种本体交互手段结合后的交互，例如将多种感官融合，比如文字、语音、视觉、动作、环境等。
  - 人与人交流的过程中，表情、手势、拥抱、触摸，甚至是气味，无不在信息交换的过程中起着不可替代的作用。显然，智能家居的人机交互势必不止语音一个模态，而是需要多模态交互并行。
  - 例如智能音箱如果看到人不在家，那就完全不需要对电视里误放出的唤醒词进行响应，甚至可以把自己调到睡眠状态；一个机器人如果感觉到主人在注视他，那么可能会主动向主人打招呼并询问是否需要提供帮助。多模态处理无疑需要引入对多类传感器数据的共同分析和计算，这些数据既包括一维的语音数据，也会包括摄像头图像以及热感应图像等二维数据。这些数据的处理无不需要本地AI的能力，也就对边缘计算提出了强力的需求。
2. **身份鉴别**
  - 智能家居系统目前普遍无法识别你是你，反而有一些智能单品能够识别。目前，通过智能门锁或者摄像头能够确认身份，但是智能门锁只在出入口，摄像头一般用于周界和出入口（虽然也有甲方曾经要求室内安装大量监控摄像头的）；而如果在室内，又该如何鉴别身份呢？
  - 人类一般是通过听觉和视觉去识别人。在智能家居系统中，是存在不少能够识别你的设备，比如带摄像头的电视机、智能音箱。与身份鉴别的场景有很多。比如回到家中，背景音乐或者智能音响包括照明都会根据你个人的喜好进行调整，这个调整是根据你的日常行为、性别、爱好、回来的时间、天气等因素并结合特定日期（生日、纪念日等）经过自我学习完成的，这个的目标是个性化。
  - 另外一个与安防有关的场景。当晚上布防之后，如果你起来活动，智能家居系统能辨识到你在活动，在你活动区域附近的安防传感器将自动屏蔽。当你离开该区域后，智能家居系统会解除屏蔽——这样做的好处是避免你去手动布撤防。
3. **定位**
  - 安防的场景其实与定位是有一定的关系，毕竟智能家居系统不仅要认出你还要认出你在哪（卧室、厨房、客厅）。可以为智能家居系统赋予3D建模功能，让其能够掌握整个家居的结构，可以将这个结构赋予给其它设备，比如扫地机器人、或者智能音箱等可能移动的设备。
  - 比如，当你在厨房一边做饭一边听智能音箱播放的音乐，此时智能音箱突然插播了一段语音“前门有陌生人来访”，并且智能音箱的屏幕上显示门口监控图像。你通过监控图像看到原来是邻居或者某个朋友，甚至可能是外卖、快递小哥等等。你对智能音箱说打开门让他进来或者对智能音箱说“快递小哥，帮我把快递放到门口，一会儿我去拿”。此时，智能音箱会将这段话通过门铃（假定带语音功能）告知门口等待的人。同样，如果在客厅看电视时，客厅电视上将出现一个小窗口显示门口监控，客厅的智能音箱通过语音提示“门外有人来访”的提示音，其它房间的电视和智能音箱并不会发出相应提示；甚至当多个电视、智能音箱在使用时，智能家居系统能够判断到底让哪个地方的电视或智能音箱发出提示（比如年轻人优先、其次是老人和小孩）。如果屋里没人，那么当有人按门铃时，无论电视或者智能音箱都不会提供有人来访的提示。
4. **连接**
  - 智能家居是人与物的连接，智慧小区是服务与人、与各家智能家居系统的连接。小区通过各类软硬兼施设施提供更人性化的服务给小区的业主。
  - 如，你设定了明天9点到某地与客户洽谈的日程安排。智能系统根据你的日程为你设定了早晨7点起床的闹钟，7点30分外卖送到，8点下楼（楼下有车辆送到小区东门），8点10东门上车。智能系统根据住所到目的地距离选择了乘车出行方式，行程是40分钟。由于你的车辆限号，于是智能系统根据你的叫车习惯选择了滴滴出行，并根据你的喜好选择了专车（不是快车也不是出租）。鉴于小区内提供了免费接送的服务，于是智能系统告知小区8点到楼下等你。依次类推，到闹钟设定——原本你设定的闹钟是7点30份，那么由于智能系统判断你需要7点起床才能赶上行程，故智能系统将会屏蔽明天7点30份的闹钟（对后天没有影响）。
5. **去中心化**和**中心化**
  - 根据纳什均衡原理，一个组织当中有一个稳定的状态，这时候群体做出的决策是最优的，任何其他的选择都会打破这样的均衡状态。人类社会恰恰存在着多种的纳什均衡——有时偏向集权，有时又偏向分权。纳什均衡其实告诉我们，群体的组织形式会在单一中心和去中心化中找到平衡点，而且这样的平衡点不止一个。
  - 那么在智能家居行业中，到底是中心化还是去中心化呢？目前的趋势还是**中心化**，就算将来每个设备都是智能设备甚至都有边缘计算的能力，那将来可能还是有一个中心去负责协调。
  - 把每个传感器、每个终端设备当做一个个人来看，把家居当做一个会议室，每个人都在自说自话；那么，会有结论么？不会。这个互相传递的命令，就像是闹市中的各类声音一般；故很大程度上还是会有一个中心，并且允许其它中心的存在。比如某个传感器发现地面脏了，可以发送命令给扫地机器人扫地。
  - 举例，当机器人发现主人不在家后自动进入了休眠状态。那么问题来了，机器人怎么发现主人不在家的？
    - 方式一：机器人在所有房间里转了一圈，没有发现主人在家，于是回到之前位置然后进入休眠并告知其它设备进入休眠。
    - 方式二：机器人在屋里喊了一嗓子“你们谁看见主人了？”（广播），所有设备告诉它没有看到或者某个设备告诉它主人外出了（比如摄像头或者音箱），于是机器人进入休眠。
    - 方式三：智能家居系统发现主人不在家后，将消息告知了机器人，于是机器人进入休眠。
    - 方式一和方式二可以看做是去中心；方式三是中心化。
6. **数据分析**
  - 如果某个智能马桶发现某个人最近一段时间每晚都要去好几次厕所，它能够推断出这个人的身体有问题么？目前的答案是：不能判断。原因是：现在的智能马桶并不能对自己产生的数据进行分析，且目前也不能判定使用者的身份。但是，一些医疗产品已经具备了基础的数据分析，他们能够根据用户的生理状态提供一些建议或帮助。由此推断，智能硬件或者智能系统有必须主动分析本设备或本系统产生的数据，并提供相关建议给用户。
7. **隐私和数据保护**
  - 智能马桶发现某个人身体可能有问题的用例，如果智能马桶将该信息传到厂家云平台进而告知相关药店或者医院，导致这个人一段时间内看到很多关于如何治好xx的广告或商品，甚至莫名其妙接到某些推送。这样的情况，是否允许发生呢？由于智能设备或智能系统保有用户大量的个人数据，并且无论智能设备或智能系统都需要定期与云平台通讯，如果通讯内容被不法分子获取，那么可能会被某些别有用心的人利用。为此，每个厂家都应该切实保护数据——无论是数据传输过程中亦或者是存储数据的云平台或者是产生的数据的设备。
  - 如果想实现智能，需要大量数据。但是出于隐私和数据保护的缘故，智能硬件或者智能系统又不能将个人隐私和数据直接传递到某个云平台，那么该如何进行模型训练呢？
    - 针对隐私：个人的数据是隐私，但是一群人的数据特征就不再是隐私。比如某个人喜欢买智能硬件和某个地区80%的男人喜欢购买智能硬件，前者涉及个人，后者不涉及个人（是可以公开的）。因此可以将个人化的数据脱敏后上传到云端，但是这个过程务必取得消费者的认同。
    - 对于模型训练的做法：可以利用边缘计算，将数据在数据本地进行初步训练，然后将结果返回到云平台进行再次训练，最终将模型下发至相应终端设备或系统。

## 智能家居行业

- [小度、天猫精灵、小爱同学硬件设备接入比较](https://baijiahao.baidu.com/s?id=1630149386111236552&wfr=spider&for=pc)
- [天猫精灵、小爱同学平台研究](https://www.jianshu.com/p/d4975edbcb52)
- 开发者网站
  - [天猫精灵设备接入](open.aligenie.com/)
  - [百度智能设备接入](dueros.baidu.com/open)
  - [小米智能设备接入](iot.mi.com/new/index.html)
- 主流厂家对AI智能的重视成都还是够了的，其中百度和阿里在界面上能够看出国际大厂的风度。小米作为后起之秀明显后劲不足。腾讯在物联网和智能家居事业上已经被逼到了角落，只有被忽略了。而华为，别人的重心根本不在这。网站有内容也足够，只是有的时候文档打不开。
- 百度、小米、阿里均支持硬件设备和云对云的接入方式,智能硬件直接接入方式相同，都需要注册为开发者，完成产品后需要平台认证，三大厂商均提供推荐的硬件模组。

### 百度

百度：标准模组为MT8516 Cortex A35的开发板，因为需要安装DuerOS所以处理器和内存都有要求。另外一些高级的模组是采用树莓派制作的。

[图](https://pics0.baidu.com/feed/9a504fc2d56285352f0dfd8a9156d4c2a5ef63ed.jpeg?token=6e2256259ecc4ec60f53bbf131390e3d&s=D2827C2B1D44FC113EF8F5D90200D0B6)

![](https://pics0.baidu.com/feed/9a504fc2d56285352f0dfd8a9156d4c2a5ef63ed.jpeg?token=6e2256259ecc4ec60f53bbf131390e3d&s=D2827C2B1D44FC113EF8F5D90200D0B6)

### [天猫精灵](https://open.bot.tmall.com/)

- **天猫精灵**是阿里巴巴人工智能实验室推出的AI智能产品品牌。天猫精灵内置AliGenie操作系统，AliGenie生活在云端，它能够听懂中文普通话语音指令，目前可实现智能家居控制、语音购物、手机充值、叫外卖、音频音乐播放等功能，带来人机交互新体验。依靠阿里云的机器学习技术和计算能力，AliGenie能够不断进化成长，了解使用者的喜好和习惯，成为人类智能助手。
- AliGenie硬件接入开放平台（AliGenie Intelligent Devices Platform），是AliGenie为企业级用户提供AI语音解决方案的开放平台。相关企业用户可以在完成开发者认证后，通过平台来申请获取AliGenie SDK、模组、麦克风阵列等能力和技术支持。
- 天猫精灵蓝牙mesh软件基础规范,定义BLE Mesh通用模块的软件规范，指导模块厂家软件设计并接入天猫精灵。
- 云云自助接入模式，鉴权流程：
  - AliGenie在开发商开放平台或者其他第三方平台注册一个应用，获取到相应的Client id 和Client secret
  - AliGenie 应用向开发商OAuth2.0服务发起一个授权请求
  - 开发商OAuth2.0服务向用户展示一个授权页面，用户可进行登陆授权
  - 用户授权AliGenie客户端应用后，进行回跳到AliGenie 的回调地址上并带上code相关参数
  - AilGenie回调地址上根据code会去合作方Oauth 的服务上换取 access_token
  - 通过access_token，天猫精灵设备控制时通过该access_token进行访问合作方的服务

  按照功能分类，包括手表、故事机、耳机、电视和音箱，提供通用设备的SDK
  ![](https://upload-images.jianshu.io/upload_images/2160113-599f363d7a1cb814)

### 小米小爱

普通MCU需要连接小米通用模组（ESP8266或者ESP32），提供Linux、Android的SDK，[图](https://pics2.baidu.com/feed/728da9773912b31b5bf687ea7ba0947ed8b4e19d.jpeg?token=e547f606ffa2b0e542dc57883c3f1dae&s=15F068320DE9780146D1C8470200C0F2)

![](https://pics2.baidu.com/feed/728da9773912b31b5bf687ea7ba0947ed8b4e19d.jpeg?token=e547f606ffa2b0e542dc57883c3f1dae&s=15F068320DE9780146D1C8470200C0F2)

## 智能家居产品

物联网在智能家居的应用

### 1、家庭安防：实时查看室内情况

安全监控系统是物联网在智能家居应用中的重中之重，通过监控摄像头、窗户传感器、智能门铃(内置摄像头)、红外监测器等有效连接在一起，用户可以通过手机、Ipad随时随地查看室内的实时情况，保障住宅安全。

### 2、智能插座：远程控制开关电器，追踪电源消耗

插座作为家用电器获得电力的基础接口，如果它具备连接互联网的功能，那么其他电器也同样可以实现。通过远程控制开关电器设备，并追踪电源消耗，帮助用户更好地节约能源。

### 3、灯光：随心所欲变换场景

通过手机应用实现开关灯、调节颜色和亮度等操作，随心所欲地变换你想要的场景氛围。

### 4、空调控温：远程温控，个性化定制

在酷热的夏季和寒冷的冬季，住宅温度的调节十分重要。依靠物联网技术，我们可以通过手机实现远程温控操作，控制每个房间的温度、定制个性化模式，甚至还能根据用户的使用习惯，通过GPS定位用户位置实现全自动温控操作。

### 5、智能洗衣机：远程控制洗衣机，智能洗涤程序

根据衣物的污渍程度、重量推算出洗衣液的用量，并注入滚筒，同时执行合适的智能洗涤程序，还能在洗涤后自动执行烘干熨烫，你所需做的只是把衣服丢进去，完事后拿出来叠整齐便可。此外，通过手机应用程序，还可以远程控制洗衣机，掌握洗衣过程。

### 6、智能冰箱：传送食品信息，更新购物清单，给出菜谱建议

只需看到显示屏就能知道冰箱内的库存情况，还可以把冰箱内的温度、库存以及将要过期的食品信息传送到手机应用上，甚至可以根据库存情况更新购物清单，自动下载菜谱。此外，用户通过设定家庭成员的基本身体数据，便可自动给出健康合理的菜谱建议。

### 7、智能烤箱：手机应用控制烤箱温度，下载菜谱

在传统烤箱上加入WIFI功能，通过手机应用控制烤箱温度，包括预热和加温，甚至可以下载菜谱，实现更具针对性的烹饪方式。不仅仅是烤箱，一些高端咖啡机、调酒机也可配备WIFI功能，并且厂商会不定期更新咖啡或鸡尾酒菜单，这样你在家也能做出咖啡厅、酒吧的味道。

### 8、智能牙刷：刷牙时间提示，分析口腔健康

牙刷通过蓝牙4.0与智能手机连接，实现刷牙时间、位置提醒;根据用户刷牙的数据生成分析图表，估算出口腔健康情况。

### 9、智能体重秤：提供健康建议，实现更精准、无缝化健康监测

通过内置传感器，实现血压、脂肪量甚至空气质量的检测，并传输至应用程序为用户提供健康建议，更可以与运动手环、智能手表等互联，实现更精准、无缝化的个人健康监测。

### 10、智能马桶：自动开关，智能分析

除了通过内置接近传感器实现自动开关盖操作，通过内置智能分析仪还能对排泄物进行分析，并将分析结果传送至手机和显示屏应用，让用户随时了解自身健康状况。

### 11、智能植物监测仪：监测湿度、温度，推送浇水时间

将仪器放置到花盆的土壤上，就能够监测其湿度、温度等，并通过应用程序推送告诉你什么时候该浇水了，可谓是"植物杀手"们的福音。

### 12、智能鱼缸：自动投喂饲料，自动定时照明杀菌

养鱼最麻烦的就是需要定时投喂饲料、照明杀菌、充气给氧。而智能鱼缸，可以帮助你每天自动定时定量投喂饲料;自动定时开关照明杀菌灯;监测鱼缸中水的pH值、盐度以及水温，并可将这些信息数据通过手机应用显示出来

# 技术篇

- Zigbee、WIFI、bluetooth之间的区别和联系[图](https://imgconvert.csdnimg.cn/aHR0cDovL3MzLjUxY3RvLmNvbS93eWZzMDIvTTAwLzZGLzg5L3dLaW9tMVdmTlh5VHRYM2VBQUlkZC12MmFWQTE1Ny5qcGc?x-oss-process=image/format,png)
![](https://imgconvert.csdnimg.cn/aHR0cDovL3MzLjUxY3RvLmNvbS93eWZzMDIvTTAwLzZGLzg5L3dLaW9tMVdmTlh5VHRYM2VBQUlkZC12MmFWQTE1Ny5qcGc?x-oss-process=image/format,png)

## ZigBee

在蓝牙技术的使用过程中，人们发现蓝牙技术尽管有许多优点，但仍存在许多缺陷。对工业，家庭自动化控制和遥测遥控领域而言，蓝牙技术显得太复杂，**功耗大**，距离**近**，组网规模**太小**等，……而工业自动化对无线通信的需求越来越强烈。正因此，经过人们长期努力，Zigbee协议在2003年中通过后，于2004正式问世了。

ZigBee，也称紫蜂，是一种低速短距离传输的无线网上协议，底层是采用IEEE 802.15.4标准规范的媒体访问层与物理层。主要特色有低速、低耗电、低成本、支持大量网上节点、支持多种网上拓扑、低复杂度、快速、可靠、安全。[图](https://img-blog.csdnimg.cn/20190320005944866.png)

由于 IEEE 802.15.4标准只定义了物理层协议和MAC 层协议，于是成立了zigbee联盟，ZigBee联盟对其网络层协议和 API 进行了标准化，还开发了安全层。经过ZigBee联盟对 IEEE 802.15.4 的改进，这才真正形成了ZigBee协议栈(Zstack)。

![](https://img-blog.csdnimg.cn/20190320005944866.png)

参考：[ZigBee简介](https://blog.csdn.net/weixin_41890971/article/details/88614696)

### ZigBee的特点

- 数据传输速率低：10KB/秒~250KB /秒，专注于低传输应用。
- 功耗低：在低功耗待机模式下，两节普通5号电池可使用6~24个月。
- 成本低：ZigBee数据传输速率低，协议简单，所以大大降低了成本。
- 网络容量大：网络可容纳 65,000 个设备。
- 时延短：通常时延都在 15ms~30ms。
- 安全： ZigBee提供了数据完整性检查和鉴权功能，采用AES-128加密算法（美国新加密算法，是目前最好的文本加密算法之一）

### 网络拓扑模型

ZigBee网络拓扑结构主要有星形网络和网型网络。不同的网络拓扑对应于不同的应用领域，在ZigBee无线网络中，不同的网络拓扑结构对网络节点的配置也不同，网络节点的类型：协调器、路由器和终端节点。

MESH网状网络拓扑结构的网络具有强大的功能，网络可以通过多级跳的方式来通信；该拓扑结构还可以组成极为复杂的网络；网络还具备自组织、自愈功能。[图](https://img-blog.csdnimg.cn/20190320092540786.png)

![](https://img-blog.csdnimg.cn/20190320092540786.png)

### 应用领域

ZigBee已广泛应用于物联网产业链中的M2M行业，如智能电网、智能交通、智能家 居、金融、移动 POS 终端、供应链自动化、工业自动化、智能建筑、消防、公共安全、环境保护、气象、数字化医疗、遥感勘测、农业、林业、水务、煤矿、石化等领域。如[图](https://img-blog.csdnimg.cn/20190320092818928.png)

![](https://img-blog.csdnimg.cn/20190320092818928.png)

## 5G

- [8分钟了解关于5G技术的一切](https://www.bilibili.com/video/BV1Dx411u74B/)
  - <iframe src="//player.bilibili.com/player.html?aid=15276094&bvid=BV1Dx411u74B&cid=24864076&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height="600" width="100%"> </iframe>
- [5G时代十大应用场景](https://www.bilibili.com/video/BV1bE411Z7uX/)
  - <iframe src="//player.bilibili.com/player.html?aid=70984662&bvid=BV1bE411Z7uX&cid=122994664&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height="600" width="100%"> </iframe>

5G在广覆盖、低延时和安全性能上有明显优势，这意味着5G可以作为物联网的高速公路，连接大量的物联网传感器应用，提高传输效率，覆盖更多设备，提供更多的解决方案。

## MQTT

- [MQTT官网](http://mqtt.org)，[MQTT V3.1.1协议规范](http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html)
- 【2020-10-24】[一文带你简单了解MQTT协议](https://zhuanlan.zhihu.com/p/152195617)
- [物联网及MQTT协议概述](https://zhuanlan.zhihu.com/p/89057819)

### 什么是MQTT

简单介绍下MQTT协议。
- `MQTT`（Message Queuing Telemetry Transport，**消息队列遥测传输**）是IBM开发的一个ISO 标准(ISO/IEC PRF 20922)下基于**发布/订阅**范式的消息协议。
- 百度百科对于MQTT协议的定义如下：
> MQTT(消息队列遥测传输)是ISO 标准(ISO/IEC PRF 20922)下基于发布/订阅范式的消息协议。它工作在 TCP/IP协议族上，是为硬件性能低下的远程设备以及网络状况糟糕的情况下而设计的发布/订阅型消息协议，为此，它需要一个消息中间件 。
- IBM在帮助石油和天然气公司客户设计有效的数据传输协议时，就出现了对MQTT这种物联网环境下的数据传输协议的需求。
- 当时，为了实现数千英里长的石油和天然气管道的无人值守监控，采取的设计方案是将管道上的传感器数据通过卫星通信传输到监控中心。
- ![](https://pic1.zhimg.com/80/v2-9eed25ea2774cddd616f16aa27fdf11c_720w.jpg)
- MQTT协议<font color='blue'>以极少的代码和有限的带宽，为连接远程设备提供实时可靠的消息服务</font>。
    - ![](https://static.runoob.com/images/mix/mqtt-fidge-2.svg)
    - 摘自：[MQTT入门介绍](https://www.runoob.com/w3cnote/mqtt-intro.html)
- 由于MQTT协议具有轻量、简单、开放和易于实现等特点。这些特点使它适用范围非常广泛。

### MQTT协议主要特性

特性如下
1. 使用**发布/订阅**消息模式，提供**一对多**的消息发布，解除应用程序耦合。
2. 对负载内容屏蔽的消息传输。
3. 使用 TCP/IP 提供网络连接。
4. 有三种消息发布服务质量(QoS)：
  - “**至多**一次” n≤1 ，消息发布完全依赖底层 TCP/IP 网络。会发生消息丢失或重复。这一级别可用于**环境传感器**数据传输这种情况。这种情况下，丢失一次读数记录也无所谓，因为不久后还会有第二次发送。
  - “**至少**一次” n≥1 ，确保消息到达，但消息重复可能会发生。
  - “**只有**一次” n=1 ，确保消息到达一次。这一级别可用于如下情况，在**计费系统**中，消息重复或丢失会导致不正确的结果。
5. 小型传输，开销很小（固定长度的头部是 2 字节），协议交换最小化，以降低网络流量。
6. 使用 Last Will 和 Testament 特性通知有关各方客户端异常中断的机制。

### TCP与MQTT

- 诞生时间
  - TCP协议诞生于1974年冷战期间。
  - MQTT诞生于1999年互联网初期，TCP协议比MQTT协议诞生早了25年。
  - Ashton提出IoT概念也是在1999年，因此MQTT协议生逢其时。当时MIT Auto-ID Labs的Kevin Ashton为了把宝洁的供应链上的RFID标签和互联网连接起来，在1999年第一个提出了IoT这个概念。
- 协议位置
  - TCP是OSI第四层的传输层协议。
  - MQTT是基于TCP的七层应用层协议。
  - ![](https://pic3.zhimg.com/80/v2-0f8f1c9dee37ec4d463e8368130967a6_720w.jpg)
- 协议定位
  - TCP设计考虑的是面向连接的、可靠的、基于字节流的传输层通信协议。
  - MQTT则是在低带宽高延迟不可靠的网络下进行数据相对可靠传输的应用层协议。
- 设计思想
  - TCP的核心思想是分组交换。
  - MQTT的核心思想是简单并适应物联网环境。
- 传输单位
  - TCP的传输单位是packet，当应用层向TCP层发送用于网间传输的、用8位字节表示的数据流，TCP则把数据流分割成适当长度的报文段，最大传输段大小（MSS）通常受该计算机连接的网络的数据链路层的最大传送单元（MTU）限制。
  - MQTT的传输单位是消息，每条消息字节上限在MQTT Broker代理服务器上进行设置，可以设置超过1M大小的消息上限。
- 技术挑战
  - TCP需要解决的问题是在IP包传输过程中，处理异构网络环境下的网络拥塞、丢包、乱序、重复包等多种问题。
  - MQTT解决的问题是，在低带宽高延迟不可靠的网络下和资源有限的硬件环境内，进行相对可靠的数据传输。
- 服务质量
  - TCP是一个可靠的流传输服务，通过ACK确认和重传机制，能够保证发送的所有字节在接收时是完全一样的，并且字节顺序也是正确的。
  - MQTT提供三种可选的消息发布的QoS服务等级。MQTT客户端和MQTT代理服务器通过session机制保证消息的传输可靠性。开发人员可以根据业务需要选择其中一种。
- 应用案例
  - TCP用于许多互联网应用程序，如WWW、email、FTP、SSH、P2P、流媒体。MQTT也是基于TCP的。
  - MQTT可以用于物联网数据传输、IM聊天软件等。

- 摘自：[你不知道的MQTT物联网协议起源——基于卫星通信的石油管道远程监控](https://zhuanlan.zhihu.com/p/69124423)


### MQTT协议原理


#### 发布、订阅工作模式

- 工作模式：
  - ![](https://pic1.zhimg.com/80/v2-f3a8f6802d2b98d22141a9b29fe6ac44_720w.jpg)
- 举例：
  - 温度传感器发布温度值到温度的主题，如果有终端订阅看温度这个主题，他就会收到代理转发的温度值
  - ![](https://pic2.zhimg.com/80/v2-bd813407fbbad91fda0cc6c9ea5c3dc9_720w.jpg)
  - 这种模式取消了硬件、客户端、服务器的概念，服务器成为了一个消息转发的代理，终端硬件和消息接收者都称之为客户端，他们都可以发布或订阅主题。如终端硬件可以发布“温度”主题下的消息，所有订阅了此主题的客户端都可以收到此消息推送，再如终端硬件订阅了“空中升级”的主题，如果有硬件驱动升级的推送，硬件就可以收到此消息，然后进行升级。

- 这种模式的优点：
  - A、空间上去耦合：信息发布者和信息接收者不需要建立直接联系，不需要知道对方的IP地址，端口等信息
  - B、时间上去耦合：发布者和接收者不需要同时在线。
- 这种模式的缺点：
  - A、发布者、接收者必须订阅相同的主题，
  - B、发布者并不确定接收者是否接受到了推送

#### MQTT协议实现方式

- 实现MQTT协议需要客户端和服务器端通讯完成，在通讯过程中，MQTT协议中有三种身份：**发布者**（Publish）、**代理**（Broker）（服务器）、**订阅者**（Subscribe）。其中，消息的发布者和订阅者都是客户端，消息代理是服务器，消息发布者可以同时是订阅者。
- MQTT传输的消息分为：**主题**（Topic）和**负载**（payload）两部分：
  - （1）Topic，可以理解为消息的类型，订阅者订阅（Subscribe）后，就会收到该主题的消息内容（payload）。
  - （2）payload，可以理解为消息的内容，是指订阅者具体要使用的内容。
- MQTT会构建底层网络传输：它将建立客户端到服务器的连接，提供两者之间的一个有序的、无损的、基于字节流的双向传输。
- 当应用数据通过MQTT网络发送时，MQTT会把与之相关的服务质量（QoS）和主题名（Topic）相关连。

#### MQTT客户端

一个使用MQTT协议的应用程序或者设备，它总是建立到服务器的网络连接。客户端可以：
- （1）发布其他客户端可能会订阅的信息。
- （2）订阅其它客户端发布的消息。
- （3）退订或删除应用程序的消息。
- （4）断开与服务器连接。


#### MQTT服务器

MQTT服务器以称为“消息代理”（Broker），可以是一个应用程序或一台设备。它是位于消息发布者和订阅者之间，它可以：
- （1）接受来自客户的网络连接；
- （2）接受客户发布的应用信息；
- （3）处理来自客户端的订阅和退订请求；
- （4）向订阅的客户转发应用程序消息。

### 主题

- ![](https://pic3.zhimg.com/80/v2-83bcfc0e8b2ccdcf9d433cf6fe13a286_720w.jpg)
- 主题通配符：（订阅消息时使用）
  - 单级通配符 +：+可以匹配单级，表示该级可以是任意主题不受限定；
  - 多级通配符 #：#可以匹配多级，通常出现在主题末尾，表示某一类主题下的所有子主题
  - 系统保留topic $：以$开头的是服务器保留的主题
- ![](https://pic1.zhimg.com/80/v2-30bc427cedbee1e13405ec1060f1d50c_720w.jpg)


### MQTT协议中的订阅、主题、会话

- （1）**订阅**（Subscription）。
  - 订阅包含主题筛选器（Topic Filter）和最大服务质量（QoS）。订阅会与一个会话（Session）关联。一个会话可以包含多个订阅。每一个会话中的每个订阅都有一个不同的主题筛选器。
- （2）**会话**（Session）。
  - 每个客户端与服务器建立连接后就是一个会话，客户端和服务器之间有状态交互。会话存在于一个网络之间，也可能在客户端和服务器之间跨越多个连续的网络连接。
- （3）**主题名**（Topic Name）连接到一个应用程序消息的标签，该标签与服务器的订阅相匹配。
  - 服务器会将消息发送给订阅所匹配标签的每个客户端。
- （4）**主题筛选器**（Topic Filter）一个对主题名通配符筛选器，在订阅表达式中使用，表示订阅所匹配到的多个主题。
- （5）**负载**（Payload）消息订阅者所具体接收的内容。

#### MQTT协议中的方法

MQTT协议中定义了一些方法（也被称为动作），来于表示对确定资源所进行操作。这个资源可以代表预先存在的数据或动态生成数据，这取决于服务器的实现。通常来说，资源指服务器上的文件或输出。主要方法有：
- （1）Connect。等待与服务器建立连接。
- （2）Disconnect。等待MQTT客户端完成所做的工作，并与服务器断开TCP/IP会话。
- （3）Subscribe。等待完成订阅。
- （4）UnSubscribe。等待服务器取消客户端的一个或多个topics订阅。
- （5）Publish。MQTT客户端发送消息请求，发送完成后返回应用程序线程。


#### 消息质量级别QoS

- （1）QS0 至多发一次。不管消息有没有收到，都不会重发。这是比较常用的质量级别，适用于很多不需要太严谨数据的场景
- （2）QS1 至少发一次。带有标志位，确保消息肯定被接收到，但有可能接受到重复消息。
- （3）QS2 只接受一次。具有严谨的信息确认，可以确保消息发送有且仅有一次 ，但对数据量的消耗较大，实现过程更复杂，适应于对数据有严格要求的场景。

![](https://pic2.zhimg.com/80/v2-ebe13ce6532d20f54d8d11d92fdc0acd_720w.jpg)

### MQTT数据格式

MQTT消息组成
- 一个MQTT消息由三个部分组成：固定头、可变头、负载。


### 建立连接

![](https://pic2.zhimg.com/80/v2-960a7e7f80cc86db4493cfd4ba9d45ed_720w.jpg)


## 操控手机

adb、fastboot命令工具

### 连接手机

ADB连接Android设备的三种方法，[原文](https://blog.csdn.net/c1063891514/article/details/79039384)
- 1. **WiFi**连接（手机与pc同一个局域网下）
  - 与电脑在同一局域网内，Android设备连接WiFi，然后adb命令#adb connect <设备IP>
- 2. USB**数据线**连接
  - 此种连接要有相应的驱动才行（应该安装phoenixsuit就可以通过数据线来通过adb连接设备，有的不用安装）https://download.csdn.net/download/c1063891514/10589989
- 3. **串口**连接
  - 使用串口设备与电脑连接。

```shell
# mac下安装adb
brew install --cask android-platform-tools
# 查看安卓手机是否已经连接上电脑
adb devices
# 让adb一直查找安卓设备，找到后才停止
adb wait-for-device
```

打开日志
- 方法一:在手机拨号盘输入:*#*#2846579#*#*，进入设置页：
  - 后台设置---->打开log日志。
  - USB端口设置-->GOOGLE模式（或生产模式）
  - 会警告影响性能。咱开发人员就不管这个了。
- 方法二：
  - adb logcat -v time > D:\logcat.txt
  - 这两种方法，其实都不能保证有LOG。
- 方法三：
  - 使用华为的HMS，调用HMSAgentLog.d(TEST);



### adb 命令

基本命令
- 连接多个安卓设备时，在adb命令后紧跟着使用 -s 加序列号 来指定要操作的设备
- 注意：建议每次只连接一个安卓设备进行操作！

华为手机开启开发者模式：
- 数据线连接电脑 → 设置 → 关于手机 → 连续点击5次版本号 → 提示输入手机锁屏密码
- 返回关于手机→ 回到设置页面 → **系统和更新** → 新出现【开发人员选项】页面
  - 依次勾选个地方：保持唤醒、“仅充电”模式下允许ADB调试、USB调试；
  - 注意：必须先设置为”仅充电”模式，然后再打开“调试模式”

【2022-2-15】Mac下连不上华为mate 30
1. *#*#2846579#*#* 进入工程模式后，选择ProjectMenu,
2. 后台设置->USB端口配置->会看到一长串的列表，只要选中“google模式”就行。然后退出工程模式
3. 然后退出工程模式，重启下机器。再连到Mac上试试，手机上会出现已经连接usb调试的提示。在系统里用”adb devices”也能查看到设备了.

[原文链接](https://blog.csdn.net/u013078986/article/details/46866193)

失败，花粉[发帖](https://club.huawei.com/forum.php?mod=viewthread&tid=30529238&extra=)

```shell
# 版本
adb server version
# 查看设备
adb devices
# List of devices attached
# FA6AX0301341    device
# ce0217122b56b02604  device

adb -s FA6AX0301341 shell
#sailfish:/ $

# 远程连接手机调试
adb connect 手机ip:5566 # 手机端需要安装无线adb应用）

# 相互传递数据
adb forward tcp:11111 tcp:22222 # 需要先建立服务端和客户端

# 2.1) 锁定/解锁/重启/关机
# 锁定/解锁手机
adb shell input keyevent 26 # 锁定手机
adb shell input keyevent 82 # 解锁手机(如果设置了密码，会提示输入密码)
# 输入密码，并回车
adb shell input text 123456 && adb shell input keyevent 66
# 重启/关机
adb reboot  # 重启
adb shell reboot  # 重启
adb shell reboot -p  # 关机

# 2.2) 系统设置
# 打开关闭蓝牙
adb shell service call bluetooth_manager 6 # 打开蓝牙
adb shell service call bluetooth_manager 9 # 关闭蓝牙
# 打开关闭wifi
adb shell svc wifi enable  # 打开wifi
adb shell svc wifi disable  # 关闭wifi
# 打开wifi设置界面
adb shell am start -a android.intent.action.MAIN -n com.android.settings/.wifi.WifiSettings
# 连接时保持亮屏 设置
svc power stayon [true|false|usb|ac|wireless]
# 参数解释：
# true: 任何情况下均保持亮屏
# false:任何情况下均不保持亮屏（经过设定的时间后自动黑屏）
# usb, ac, wireless：设置其中之一时，仅在这一种情况下才保持亮屏。

# 2.3) 模拟本机操作

# 模拟按键操作
adb shell input keyevent 111 # 关闭软键盘(其实是按下ESC，111=KEYCODE_ESCAPE)
# 更多按键代码，在这里 https://developer.android.com/reference/android/view/KeyEvent.html

# 模拟滑动触屏操作
adb shell input touchscreen swipe 930 880 930 380 # 向上滑
adb shell input touchscreen swipe 930 880 330 880 # 向左滑
adb shell input touchscreen swipe 330 880 930 880 # 向右滑
adb shell input touchscreen swipe 930 380 930 880 # 向下滑
# 模拟鼠标操作
adb shell input mouse tap 100 500
#100是x，500是y。
#原点在屏幕左上角。

# 2.4) 运行程序

# 拨打电话
adb shell am start -a android.intent.action.CALL -d tel:10010
# 打开网站
adb shell am start -a android.intent.action.VIEW -d  http://google.com
# 启动APP
adb shell am start -n com.package.name/com.package.name.MainActivity
adb shell am start -n com.package.name/.MainActivity

adb shell monkey -p com.android.contacts -c android.intent.category.LAUNCHER 1
# Events injected: 1
## Network stats: elapsed time=16ms (0ms mobile, 0ms wifi, 16ms not connected)

# 3) 硬件高级调节
# 3.0) 信息查看
# 查看设备序列号
adb get-serialno
# 3.1) CPU相关
# 查看CPU温度
# 先查看有哪些温度区域thermal zone
adb shell ls sys/class/thermal/
# cooling_device0
# cooling_device1
# cooling_device2
# 
# thermal_zone0
# thermal_zone1
# thermal_zone2

# 查看某个CPU温度

cat /sys/class/thermal/thermal_zone0/temp                                                                                                
# 25800 # 温度是milliCelsius，所以这里是25.8度C。

# CPU设置
# 查看当前手机可用的governor
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors                                                                     
# userspace interactive performance
# 锁定CPU为最大频率
# 参考：https://forum.xda-developers.com/showthread.php?t=1663809

# 设置CPU governor为performance。

echo performance > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor

# 4) 刷机
# 重启手机，进入recovery或bootloader模式
adb reboot recovery # 恢复模式
adb reboot bootloader  # 刷机模式。不同手机，命令不同，要试一下。
adb reboot-bootloader
adb reboot boot loader
# 进入 fastboot 模式。
adb  reboot  fastboot
# 或关机，然后同时按住 增加音量 和 电源 键开机

# 5) 调试
# 抓取开机日志
adb wait-for-device && adb shell logcat -v threadtime | tee mybootup.log
# 查看日志
adb logcat
# 关闭/重启adb服务进程
adb kill-server
adb start-server
# 从本地复制文件到设备，或者反之
adb push test.zip /sdcard/  # 从本地复制文件到设备
adb pull /sdcard/abc.zip  ~/  # 从设备复制文件到本地
# 显示已经安装的APP的包名
adb shell pm list packages
# 安装、删除APP
adb install abc.apk # 第一次安装。如果手机上已经有此app,则会报错。
adb install -r abc.apk # 如果已经安装过，保留原app的数据
adb -s 11223344 install abc.apk  # 当多个安卓连接到电脑时，安装到指定一台安卓上
adb uninstall com.example.appname
# 查看apk的版本（无需解压）
aapt dump badging abcd.apk |grep version
# 捕获键盘操作
adb shell getevent -ltr 
# 查看屏幕分辨率 dpi
wm density
wm size
# 设置：
wm density 240
# 立刻生效。
```

### OTG

OTG是On-The-Go的缩写，此技术于2001年12月18日由USB Implementers Forum公布，在2014年左右开始在市场普及。OTG技术主要是基于USB技术的发展和普及而来，完全兼容USB2.0协议。
- ![](https://pic2.zhimg.com/80/v2-c17dbea1306167cbf78fa403955c22ad_720w.jpg)

使用OTG可以**脱离计算机设备**，利用各种设备上的USB口进行数据交换。解决了各种设备间不同制式的连接接口的数据交换不便的问题。
- OTG主要应用于各种**不同设备（包括移动设备）间的联接**，尤其是现在市面上琳琅满目的各种移动电子设备，比如平板电脑、移动电话、打印机、消费类电子设备等。目前市面上的智能手机上基本都支持OTG。


OTG是指在无电脑作为中转站的情况下，直接将手机连接U盘、读卡器、MP3、键盘、数码相机等外部设备进行数据传输、输入操作或充电等功能。通过OTG技术，可以给智能终端扩展USB接口配件以丰富智能终端的功能，比如扩展遥控器配件，把手机、平板变成万能遥控器使用。

鉴于设备接口及USB类型的不一致，一般OTG有如下几类：
- USB2.0 OTG：包括Micro 5PIN OTG（常见安卓手机）、Mini 5PIN OTG（常见安卓平板）
- Micro USB3.0 OTG：三星Note3、Galaxy S5等在2016年以前的安卓手机OTG接口
- Type-C OTG：目前支持Type-C接口的设备（比如小米Mix系列等）
- Lightning OTG：苹果手机专用OTG

![](https://pic3.zhimg.com/80/v2-e527ac0de41bbe029ff61e58dda21b4e_720w.jpg)

OTG有哪些应用场景
- 1、**数据传输**
  - 这个场景比较常见，比如使用OTG数据线将手机和计算机连接后，将数据在手机和计算机间进行传输。
  - 出差在外，电脑不方便联网，可以使用手机或平板接收数据后，使用支持OTG功能的U盘将数据从手机拷出，然后再将U盘插到电脑上使用。
  - 使用OTG线，将手机或相机和打印机连接后，直接将照片打印出来。
  - 使用OTG线，连接移动硬盘，播放其中存储的高清视频或将手机中的照片视频导入等。
- 2、**系统重做**（刷机）
  - 当手机或其他设备宕机后，可以使用OTG线将装有系统刷机包的U盘连接后加电重启后通过加载刷机包进行刷机。
- 3、**外接设备**
  - 比较常见的支持USB的设备均可通过OTG方式进行连接，常见的比如键盘、手机、游戏操作手柄等等。
  - ![](https://iknow-pic.cdn.bcebos.com/f7246b600c3387447f2cb2e45f0fd9f9d62aa0b9)
- 4、临时**反向充电**
  - 当外出在外，有些小设备（手环、智能手表、MP3等）没有电时，可以通过使用支持反向充电的专用OTG线连接手机进行充电。

### 手机屏幕坏了怎么操控

【2022-2-15】华为手机屏幕摔碎，无法操控，手机屏幕碎了，如何连接电脑？ - [鹤啸九天的回答](https://www.zhihu.com/question/278365377/answer/2348879230)

换屏费用高达1380元（上门），屏下指纹花费高，普通触控屏幕400元
- （1）使用OTG转接头，投影到显示器，通过鼠标操控屏幕，前提是屏幕没有完全损坏
- （2）电脑上安装一个安卓手机**模拟器**，然后连上手机。电脑上的模拟器上就可以看到你手机的屏幕状态。


# 实战

- 待定

## 阿里云操作智能家居

- 参考视频：[物联网实战分析，阿里云app远程控制到底如何实现？数据如何传递](https://www.ixigua.com/6870431495928939016/)
- 【2021-9-29】头条自媒体用户[超子说物联网](https://www.ixigua.com/home/83150758754035/)
物联网爱好者；创作各种物联网平台使用心得
  - 示例： [做个入门小程序，App远程控制ESP8266继电器，阿里云物联网平台](https://www.ixigua.com/6931591512232821261)：使用阿里云物联网开发平台，利用mqtt应用层协议，使用app远程控制ESP8266继电器。
  - [STM32，51单片机DIY智能家居浇花器](https://www.ixigua.com/6805411318057665035)，用天猫精灵或者APP远程控制

## 智能插座

[中学生自制全站最漂亮物联网WIFI(智能?)插座](https://www.bilibili.com/video/BV1dt41187Cm/)，松果派开源硬件创始人
- <iframe src="//player.bilibili.com/player.html?aid=41300825&bvid=BV1dt41187Cm&cid=72538417&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" height="600" width="100%"> </iframe>

## 温度传感器

【2017-10-01】[智能家居——IoT零基础入门篇](https://www.cnblogs.com/rainmote/p/7617454.html)
DIY一个温湿度传感器：用Home Assistant&Homebridge实现了一个智能家居设备从数据采集到控制、展示。整体架构[图](https://images2017.cnblogs.com/blog/572260/201710/572260-20171001171318856-1589386057.png)
- 智能设备：温湿度传感器
  - ![](https://images2017.cnblogs.com/blog/572260/201710/572260-20171001172957387-911968968.jpg)
- 主控芯片：STM32F103C8T6
- 通信协议：Zigbee
- 智能网关：树莓派
- 数据存储、展示、设备控制：HomeAssistant + Home Kit
![](https://images2017.cnblogs.com/blog/572260/201710/572260-20171001171318856-1589386057.png)

Home Assistant效果图

![](https://images2017.cnblogs.com/blog/572260/201710/572260-20171001173117919-1163730309.jpg)
搭建Web服务器时，查阅网上相关资料，无意间发下了新大陆，[Home Assistant](https://home-assistant.io/)，太符合我的需求。安装教程可[参考](https://zhuanlan.zhihu.com/p/28011522)，国内[论坛](https://bbs.hassbian.com/forum.php)

Home Kit效果图
![](https://images2017.cnblogs.com/blog/572260/201710/572260-20171001172645950-703912073.jpg)

智能家居控制展示图
![](https://images2017.cnblogs.com/blog/572260/201710/572260-20171001210827184-546554724.png)



# 结束
















