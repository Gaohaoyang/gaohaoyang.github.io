I"h<ul id="markdown-toc">
  <li><a href="#ç»„ä»¶å¤šæ¬¡è¢«å¤ç”¨çš„åœºæ™¯" id="markdown-toc-ç»„ä»¶å¤šæ¬¡è¢«å¤ç”¨çš„åœºæ™¯">ç»„ä»¶å¤šæ¬¡è¢«å¤ç”¨çš„åœºæ™¯</a></li>
  <li><a href="#ä½¿ç”¨-reactmemo-ä¼˜åŒ–" id="markdown-toc-ä½¿ç”¨-reactmemo-ä¼˜åŒ–">ä½¿ç”¨ React.memo ä¼˜åŒ–</a></li>
  <li><a href="#usecallback" id="markdown-toc-usecallback">useCallback</a>    <ul>
      <li><a href="#ä»€ä¹ˆæ˜¯-usecallback" id="markdown-toc-ä»€ä¹ˆæ˜¯-usecallback">ä»€ä¹ˆæ˜¯ useCallback</a></li>
      <li><a href="#å¦‚ä½•ä½¿ç”¨-usecallback" id="markdown-toc-å¦‚ä½•ä½¿ç”¨-usecallback">å¦‚ä½•ä½¿ç”¨ useCallback</a></li>
    </ul>
  </li>
  <li><a href="#å°ç»“" id="markdown-toc-å°ç»“">å°ç»“</a></li>
</ul>

<p>æœ¬ç³»åˆ—å°†è®²è¿° React Hooks çš„ä½¿ç”¨æ–¹æ³•ï¼Œä» useState å¼€å§‹ï¼Œå°†åŒ…å«å¦‚ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li><a href="https://juejin.im/post/6844904111024930824">useState</a></li>
  <li><a href="https://juejin.im/post/6844904153580306446">useEffect</a></li>
  <li><a href="https://juejin.im/post/6844904153584500749">useContext</a></li>
  <li><a href="https://juejin.im/post/6844904157892050957">useReducer</a></li>
  <li><a href="https://juejin.im/post/6844904162040233997">useCallback</a></li>
  <li><a href="https://juejin.im/post/6844904162304458760">useMemo</a></li>
  <li><a href="https://juejin.im/post/6844904168562360328">useRef</a></li>
  <li><a href="https://juejin.im/post/6844904169539633166">custom hooks</a></li>
</ul>

<p>æŒæ¡ React Hooks api å°†æ›´å¥½çš„å¸®åŠ©ä½ åœ¨å·¥ä½œä¸­ä½¿ç”¨ï¼Œå¯¹ React çš„æŒæ¡æ›´ä¸Šä¸€å±‚æ¥¼ã€‚æœ¬ç³»åˆ—å°†ä½¿ç”¨å¤§é‡å®ä¾‹ä»£ç å’Œæ•ˆæœå±•ç¤ºï¼Œéå¸¸æ˜“äºåˆå­¦è€…å’Œå¤ä¹ ä½¿ç”¨ã€‚</p>

<p>åœ¨æˆ‘ä»¬å¼€å§‹æ·±å…¥å­¦ä¹  useCallback å‰ï¼Œå…ˆå›é¡¾ä¸€ä¸‹æ€§èƒ½ä¼˜åŒ–ç›¸å…³çš„å†…å®¹ï¼Œè¿™å°†æœ‰åŠ©äºæˆ‘ä»¬ç†è§£ä»€ä¹ˆæ˜¯ useCallbackï¼Œä¸ºä»€ä¹ˆä½¿ç”¨å®ƒï¼Œä»¥åŠæ€ä¹ˆä½¿ç”¨å®ƒã€‚</p>

<p>ä¾ç„¶å…ˆä»ä¸€ä¸ªç»„ä»¶å¤šæ¬¡è¢«å¤ç”¨çš„ä»£ç åœºæ™¯çœ‹èµ·ã€‚</p>

<h2 id="ç»„ä»¶å¤šæ¬¡è¢«å¤ç”¨çš„åœºæ™¯">ç»„ä»¶å¤šæ¬¡è¢«å¤ç”¨çš„åœºæ™¯</h2>

<p>æœ‰å¦‚ä¸‹çš„ï¼Œç»„ä»¶æ ‘ç»“æ„ã€‚ParentWrap åŒ…å« Title ç»„ä»¶ã€2æ¬¡ä½¿ç”¨ Count ç»„ä»¶ã€2æ¬¡ä½¿ç”¨ Button ç»„ä»¶ã€‚</p>

<p>ç‚¹å‡» Buttonï¼Œå¯¹åº”çš„ Count åˆ†åˆ«ä¼šå¢åŠ ã€‚</p>

<p><img src="https://user-gold-cdn.xitu.io/2020/5/18/17226e2be3884074?w=1270&amp;h=595&amp;f=png&amp;s=7901" alt="" /></p>

<p>App.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">ParentComponent</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./components/26ParentComponenet</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"App"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">ParentComponent</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span>
</code></pre></div></div>

<p>ParentComponent.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Title</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./26Title</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Count</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./26Count</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Button</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./26Button</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">ParentComponenet</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">age</span><span class="p">,</span> <span class="nx">setAge</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">salary</span><span class="p">,</span> <span class="nx">setSalary</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">50000</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">incrementAge</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setAge</span><span class="p">(</span><span class="nx">age</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="kd">const</span> <span class="nx">incrementSalary</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setSalary</span><span class="p">(</span><span class="nx">salary</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Title</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Count</span>
        <span class="na">text</span><span class="p">=</span><span class="s">"Age"</span>
        <span class="na">count</span><span class="p">=</span><span class="si">{</span><span class="nx">age</span><span class="si">}</span>
      <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Button</span>
        <span class="na">handleClick</span><span class="p">=</span><span class="si">{</span><span class="nx">incrementAge</span><span class="si">}</span>
      <span class="p">&gt;</span>Increment age<span class="p">&lt;/</span><span class="nc">Button</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Count</span>
        <span class="na">text</span><span class="p">=</span><span class="s">"Salary"</span>
        <span class="na">count</span><span class="p">=</span><span class="si">{</span><span class="nx">salary</span><span class="si">}</span>
      <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Button</span>
        <span class="na">handleClick</span><span class="p">=</span><span class="si">{</span><span class="nx">incrementSalary</span><span class="si">}</span>
      <span class="p">&gt;</span>Increment salary<span class="p">&lt;/</span><span class="nc">Button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">ParentComponenet</span>
</code></pre></div></div>

<p>Title.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">Title</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Rendering Title</span><span class="dl">'</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>useCallback<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">Title</span>
</code></pre></div></div>

<p>Count.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">Count</span><span class="p">(</span><span class="nx">props</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">text</span><span class="p">:</span> <span class="nx">string</span>
  <span class="nx">count</span><span class="p">:</span> <span class="nx">number</span>
<span class="p">})</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Rendering </span><span class="p">${</span><span class="nx">props</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">text</span><span class="si">}</span> - <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">count</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">Count</span>
</code></pre></div></div>

<p>Button.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">Button</span><span class="p">(</span><span class="nx">props</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">handleClick</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span>
  <span class="nx">children</span><span class="p">:</span> <span class="nx">string</span>
<span class="p">})</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Rendering button</span><span class="dl">'</span><span class="p">,</span> <span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">handleClick</span><span class="si">}</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">Button</span>
</code></pre></div></div>

<p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„ jsx ä»£ç å†™åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬è¿™ä¹ˆç»„ç»‡ä»£ç çš„ä¸»è¦åŸå› æ˜¯è®©å¤§å®¶ç†è§£ react ä¸­çš„æ€§èƒ½ä¼˜åŒ–ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ useCallback api è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>

<p>é¡µé¢å±•ç¤ºæ•ˆæœå¦‚ä¸‹</p>

<p><img src="https://user-gold-cdn.xitu.io/2020/5/18/17226e2be38b1a98?w=702&amp;h=606&amp;f=gif&amp;s=85359" alt="" /></p>

<p>è€Œæˆ‘ä»¬è¦å…³æ³¨åˆ°çš„æ˜¯æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥åœ¨ console ä¸­çœ‹åˆ°ï¼Œæ¯æ¬¡ç‚¹å‡»æ—¶ï¼Œçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Rendering Title
Rendering Age
Rendering button Increment age
Rendering Salary
Rendering button Increment salary
</code></pre></div></div>

<p>æ¯æ¬¡çŠ¶æ€æ”¹å˜éƒ½è§¦å‘äº†æ‰€æœ‰ç»„ä»¶çš„ rerenderï¼Œè¿™ä¸ªç¤ºä¾‹æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å‡å¦‚æœªæ¥é‡åˆ°20ã€30ã€ç”šè‡³50ä¸ªç»„ä»¶ rerender çš„æ—¶å€™ï¼Œå°±ä¸€å®šè¦è€ƒè™‘åˆ°æ€§èƒ½é—®é¢˜äº†ã€‚ä¸‹é¢è®²è®²åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­æ€ä¹ˆè¿›è¡Œä¼˜åŒ–ã€‚</p>

<h2 id="ä½¿ç”¨-reactmemo-ä¼˜åŒ–">ä½¿ç”¨ React.memo ä¼˜åŒ–</h2>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å½“ç„¶å¸Œæœ›ç‚¹å‡»å¢åŠ å¹´é¾„çš„æŒ‰é’®æ—¶ï¼Œåªæœ‰å…³äºå¹´é¾„çš„ Count å’Œ Button è¿›è¡Œ rerenderï¼Œè€Œå…¶ä»–ç»„ä»¶ä¸å‘ç”Ÿ rerenderï¼Œç‚¹å‡»å¢åŠ  salary æ—¶ä¹Ÿä¸€æ ·ã€‚å¦‚ä½•æ‰èƒ½åšåˆ°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ <code class="language-plaintext highlighter-rouge">React.memo</code>ã€‚</p>

<p>æˆ‘ä»¬ç»™ Title.tsx, Count.tsx, Button.tsx æ·»åŠ  <code class="language-plaintext highlighter-rouge">React.memo()</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<p>Title.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">Title</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Rendering Title</span><span class="dl">'</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>useCallback<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">Title</span><span class="p">)</span>

</code></pre></div></div>

<p>Count.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">Count</span><span class="p">(</span><span class="nx">props</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">text</span><span class="p">:</span> <span class="nx">string</span>
  <span class="nx">count</span><span class="p">:</span> <span class="nx">number</span>
<span class="p">})</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Rendering </span><span class="p">${</span><span class="nx">props</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">text</span><span class="si">}</span> - <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">count</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">Count</span><span class="p">)</span>
</code></pre></div></div>

<p>Button.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">Button</span><span class="p">(</span><span class="nx">props</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">handleClick</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span>
  <span class="nx">children</span><span class="p">:</span> <span class="nx">string</span>
<span class="p">})</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Rendering button</span><span class="dl">'</span><span class="p">,</span> <span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">handleClick</span><span class="si">}</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">Button</span><span class="p">)</span>
</code></pre></div></div>

<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="https://user-gold-cdn.xitu.io/2020/5/18/17226e2be462d40e?w=702&amp;h=606&amp;f=gif&amp;s=110065" alt="" /></p>

<blockquote>
  <p>React.memo ä¸ºé«˜é˜¶ç»„ä»¶ã€‚å®ƒä¸ React.PureComponent éå¸¸ç›¸ä¼¼ï¼Œä½†åªé€‚ç”¨äºå‡½æ•°ç»„ä»¶ï¼Œè€Œä¸é€‚ç”¨ class ç»„ä»¶ã€‚</p>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">MyComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span> <span class="nx">MyComponent</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ä½¿ç”¨ props æ¸²æŸ“ */</span>
<span class="p">});</span>
</code></pre></div></div>

<blockquote>
  <p>å¦‚æœä½ çš„å‡½æ•°ç»„ä»¶åœ¨ç»™å®šç›¸åŒ props çš„æƒ…å†µä¸‹æ¸²æŸ“ç›¸åŒçš„ç»“æœï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡å°†å…¶åŒ…è£…åœ¨ React.memo ä¸­è°ƒç”¨ï¼Œä»¥æ­¤é€šè¿‡è®°å¿†ç»„ä»¶æ¸²æŸ“ç»“æœçš„æ–¹å¼æ¥æé«˜ç»„ä»¶çš„æ€§èƒ½è¡¨ç°ã€‚è¿™æ„å‘³ç€åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒReact å°†è·³è¿‡æ¸²æŸ“ç»„ä»¶çš„æ“ä½œå¹¶ç›´æ¥å¤ç”¨æœ€è¿‘ä¸€æ¬¡æ¸²æŸ“çš„ç»“æœã€‚</p>

  <p>React.memo ä»…æ£€æŸ¥ props å˜æ›´ã€‚å¦‚æœå‡½æ•°ç»„ä»¶è¢« React.memo åŒ…è£¹ï¼Œä¸”å…¶å®ç°ä¸­æ‹¥æœ‰ useState æˆ– useContext çš„ Hookï¼Œå½“ context å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä»ä¼šé‡æ–°æ¸²æŸ“ã€‚</p>

  <p>é»˜è®¤æƒ…å†µä¸‹å…¶åªä¼šå¯¹å¤æ‚å¯¹è±¡åšæµ…å±‚å¯¹æ¯”ï¼Œå¦‚æœä½ æƒ³è¦æ§åˆ¶å¯¹æ¯”è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¯·å°†è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ¥å®ç°ã€‚</p>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">MyComponent</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ä½¿ç”¨ props æ¸²æŸ“ */</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">areEqual</span><span class="p">(</span><span class="nx">prevProps</span><span class="p">,</span> <span class="nx">nextProps</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*
  å¦‚æœæŠŠ nextProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸
  å°† prevProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸€è‡´åˆ™è¿”å› trueï¼Œ
  å¦åˆ™è¿”å› false
  */</span>
<span class="p">}</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">MyComponent</span><span class="p">,</span> <span class="nx">areEqual</span><span class="p">);</span>
</code></pre></div></div>

<blockquote>
  <p>æ­¤æ–¹æ³•ä»…ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ–¹å¼è€Œå­˜åœ¨ã€‚ä½†è¯·ä¸è¦ä¾èµ–å®ƒæ¥â€œé˜»æ­¢â€æ¸²æŸ“ï¼Œå› ä¸ºè¿™ä¼šäº§ç”Ÿ bugã€‚</p>
</blockquote>

<p>ä½†æ˜¯ï¼Œä½¿ç”¨äº† React.memo åï¼Œæˆ‘ä»¬çœ‹åˆ°ç‚¹å‡»å¢åŠ å¹´é¾„çš„æŒ‰é’®æ—¶ï¼Œæ—¥å¿—å˜ä¸ºäº†</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Rendering Age
Rendering button Increment age
Rendering button Increment salary
</code></pre></div></div>

<p>ä¾ç„¶æœ‰ä¸ç›¸å…³çš„ rerender <code class="language-plaintext highlighter-rouge">Rendering button Increment salary</code>ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ã€‚</p>

<p>åœ¨ ParentComponenet.tsx ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ç‚¹å‡» Increment age æŒ‰é’®æ—¶ï¼Œå¯¼è‡´äº† state å˜åŒ–ï¼ŒParentComponenet è¿›è¡Œäº† rerenderã€‚<code class="language-plaintext highlighter-rouge">&lt;Title /&gt;</code> æ²¡æœ‰ä¼ å…¥å±æ€§ï¼ŒReact.memo åˆ¤æ–­å‡ºä¸éœ€è¦ rerenderï¼Œä½†æ˜¯ Increment salary æŒ‰é’®ä¸Šçš„å±æ€§ incrementSalary æ–¹æ³•ï¼Œå®é™…ä¸Šè¢«é‡æ–°åˆ›å»ºäº†ï¼Œå¯¼è‡´äº†è¿™ä¸ª Button ä¼ å…¥çš„ props å‘ç”Ÿäº†å˜åŒ–ï¼Œå› æ­¤ React.memo æ²¡æœ‰é˜»æ­¢ rerenderã€‚ç‚¹å‡»æŒ‰é’® Increment salary å¯¼è‡´çš„ç›¸åŒçš„ç°è±¡ä¹Ÿæ˜¯åŒç†ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨ useCallback hookã€‚</p>

<h2 id="usecallback">useCallback</h2>

<h3 id="ä»€ä¹ˆæ˜¯-usecallback">ä»€ä¹ˆæ˜¯ useCallback</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">memoizedCallback</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">],</span>
<span class="p">);</span>
</code></pre></div></div>

<blockquote>
  <p>è¿”å›ä¸€ä¸ª memoized å›è°ƒå‡½æ•°ã€‚</p>

  <p>æŠŠå†…è”å›è°ƒå‡½æ•°åŠä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ <code class="language-plaintext highlighter-rouge">useCallback</code>ï¼Œå®ƒå°†è¿”å›è¯¥å›è°ƒå‡½æ•°çš„ memoized ç‰ˆæœ¬ï¼Œè¯¥å›è°ƒå‡½æ•°ä»…åœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°ã€‚å½“ä½ æŠŠå›è°ƒå‡½æ•°ä¼ é€’ç»™ç»è¿‡ä¼˜åŒ–çš„å¹¶ä½¿ç”¨å¼•ç”¨ç›¸ç­‰æ€§å»é¿å…éå¿…è¦æ¸²æŸ“ï¼ˆä¾‹å¦‚ shouldComponentUpdateï¼‰çš„å­ç»„ä»¶æ—¶ï¼Œå®ƒå°†éå¸¸æœ‰ç”¨ã€‚</p>
</blockquote>

<p>ç±»æ¯”åˆ°æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒuseCallback ä¼šç¼“å­˜æˆ‘ä»¬çš„ <code class="language-plaintext highlighter-rouge">incrementSalary()</code> å¦‚æœ salary æ²¡æœ‰å˜åŒ–ï¼Œç›´æ¥è¿”å›ç¼“å­˜çš„å€¼ï¼Œå¦‚æœ salary å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯ useCallback çš„ä¾èµ–å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çš„æ–¹æ³•å°†è¢«è¿”å›ã€‚</p>

<p>è¿™å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³åªä¾èµ–æŸä¸ªå˜é‡çš„å­ç»„ä»¶é¿å…ä¸å¿…è¦çš„ render é—®é¢˜ã€‚</p>

<h3 id="å¦‚ä½•ä½¿ç”¨-usecallback">å¦‚ä½•ä½¿ç”¨ useCallback</h3>

<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>

<ol>
  <li>import useCallback</li>
  <li>è°ƒç”¨ useCallback</li>
</ol>

<p>æˆ‘ä»¬å°† ParentComponenet.tsx ä¸­çš„ incrementAge å’Œ incrementSalary ä½¿ç”¨ useCallback æ”¹å†™å¦‚ä¸‹ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">incrementAge</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setAge</span><span class="p">(</span><span class="nx">age</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="p">[</span><span class="nx">age</span><span class="p">],</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">incrementSalary</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setSalary</span><span class="p">(</span><span class="nx">salary</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="p">[</span><span class="nx">salary</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="https://user-gold-cdn.xitu.io/2020/5/18/17226e2be53124b0?w=702&amp;h=411&amp;f=gif&amp;s=99118" alt="" /></p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ï¼Œç‚¹å‡» Increment age æ—¶ï¼Œsalary çš„æŒ‰é’®ç»„ä»¶ä¹Ÿæ²¡æœ‰ rerenderã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰çš„æ€§èƒ½ä¼˜åŒ–ã€‚</p>

<h2 id="å°ç»“">å°ç»“</h2>

<p>æœ¬ç« æˆ‘ä»¬ä»ä¸€ä¸ªç»„ä»¶å¤šæ¬¡è¢«å¤ç”¨çš„çš„ä¾‹å­è¯´èµ·ï¼Œä¸€æ­¥ä¸€æ­¥å¯¹å…¶è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œæ ¸å¿ƒæ˜¯é˜»æ­¢ä¸å¿…è¦çš„ rerenderã€‚</p>

<p>å­¦ä¹ ä½¿ç”¨äº† React.memo åœ¨ props æˆ– state æ²¡æœ‰å˜åŒ–æ—¶ï¼Œé˜»æ­¢ç»„ä»¶çš„ rerenderã€‚</p>

<p>å­¦ä¹ äº†ä»€ä¹ˆæ˜¯ useCallbackï¼Œå¦‚ä½•ä½¿ç”¨ useCallback ç¼“å­˜ä¸€ä¸ªæ–¹æ³•ï¼Œåªä¾èµ–æŸå‡ ä¸ªå˜é‡å˜åŒ–æ‰æ›´æ–°ï¼Œé¿å…äº†æ¯æ¬¡ä¼ é€’ç»™å­ç»„ä»¶çš„ props éƒ½è¢«æ›´æ–°ï¼Œæœ€ç»ˆä¹Ÿæ˜¯é˜»æ­¢äº†å­ç»„ä»¶ä¸å¿…è¦çš„ rerenderã€‚</p>
:ET