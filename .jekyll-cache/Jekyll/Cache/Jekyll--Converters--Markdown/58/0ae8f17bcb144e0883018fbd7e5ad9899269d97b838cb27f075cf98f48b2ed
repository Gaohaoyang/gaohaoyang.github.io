I"§"<ul id="markdown-toc">
  <li><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-useeffect" id="markdown-toc-ä¸ºä»€ä¹ˆä½¿ç”¨-useeffect">ä¸ºä»€ä¹ˆä½¿ç”¨ useEffect</a>    <ul>
      <li><a href="#ç”Ÿå‘½å‘¨æœŸä¸­å†™é€»è¾‘çš„é—®é¢˜" id="markdown-toc-ç”Ÿå‘½å‘¨æœŸä¸­å†™é€»è¾‘çš„é—®é¢˜">ç”Ÿå‘½å‘¨æœŸä¸­å†™é€»è¾‘çš„é—®é¢˜</a></li>
      <li><a href="#useeffect-è§£å†³çš„é—®é¢˜" id="markdown-toc-useeffect-è§£å†³çš„é—®é¢˜">useEffect è§£å†³çš„é—®é¢˜</a></li>
    </ul>
  </li>
  <li><a href="#useeffect-after-render-çš„ä½¿ç”¨" id="markdown-toc-useeffect-after-render-çš„ä½¿ç”¨">useEffect After Render çš„ä½¿ç”¨</a>    <ul>
      <li><a href="#class-ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹" id="markdown-toc-class-ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹">Class ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹</a></li>
      <li><a href="#ä½¿ç”¨-useeffect-æ”¹å†™ä¸Šè¿°ç¤ºä¾‹" id="markdown-toc-ä½¿ç”¨-useeffect-æ”¹å†™ä¸Šè¿°ç¤ºä¾‹">ä½¿ç”¨ useEffect æ”¹å†™ä¸Šè¿°ç¤ºä¾‹</a></li>
    </ul>
  </li>
  <li><a href="#æœ‰æ¡ä»¶åœ°æ‰§è¡Œ-useeffect" id="markdown-toc-æœ‰æ¡ä»¶åœ°æ‰§è¡Œ-useeffect">æœ‰æ¡ä»¶åœ°æ‰§è¡Œ useEffect</a>    <ul>
      <li><a href="#class-ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹-1" id="markdown-toc-class-ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹-1">Class ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹</a></li>
      <li><a href="#useeffect-çš„å†™æ³•" id="markdown-toc-useeffect-çš„å†™æ³•">useEffect çš„å†™æ³•</a></li>
    </ul>
  </li>
  <li><a href="#åªæ‰§è¡Œ1æ¬¡-useeffect" id="markdown-toc-åªæ‰§è¡Œ1æ¬¡-useeffect">åªæ‰§è¡Œ1æ¬¡ useEffect</a>    <ul>
      <li><a href="#è®°å½•é¼ æ ‡ä½ç½®ç¤ºä¾‹-class-å†™æ³•" id="markdown-toc-è®°å½•é¼ æ ‡ä½ç½®ç¤ºä¾‹-class-å†™æ³•">è®°å½•é¼ æ ‡ä½ç½®ç¤ºä¾‹ Class å†™æ³•</a></li>
      <li><a href="#useeffect-ä¸­è®°å½•é¼ æ ‡åæ ‡" id="markdown-toc-useeffect-ä¸­è®°å½•é¼ æ ‡åæ ‡">useEffect ä¸­è®°å½•é¼ æ ‡åæ ‡</a></li>
    </ul>
  </li>
  <li><a href="#éœ€è¦æ¸…é™¤çš„-effect" id="markdown-toc-éœ€è¦æ¸…é™¤çš„-effect">éœ€è¦æ¸…é™¤çš„ Effect</a>    <ul>
      <li><a href="#æ˜¾ç¤ºä¸ç§»é™¤ç»„ä»¶" id="markdown-toc-æ˜¾ç¤ºä¸ç§»é™¤ç»„ä»¶">æ˜¾ç¤ºä¸ç§»é™¤ç»„ä»¶</a></li>
      <li><a href="#componentwillunmount" id="markdown-toc-componentwillunmount">componentWillUnmount</a></li>
    </ul>
  </li>
  <li><a href="#useeffect-ä¸­ä¾èµ–é”™è¯¯å¯¼è‡´çš„-bug" id="markdown-toc-useeffect-ä¸­ä¾èµ–é”™è¯¯å¯¼è‡´çš„-bug">useEffect ä¸­ä¾èµ–é”™è¯¯å¯¼è‡´çš„ bug</a>    <ul>
      <li><a href="#class-ç»„ä»¶ç¤ºä¾‹" id="markdown-toc-class-ç»„ä»¶ç¤ºä¾‹">Class ç»„ä»¶ç¤ºä¾‹</a></li>
      <li><a href="#hooks-ç¤ºä¾‹" id="markdown-toc-hooks-ç¤ºä¾‹">hooks ç¤ºä¾‹</a></li>
      <li><a href="#å¤šä¸ª-useeffect" id="markdown-toc-å¤šä¸ª-useeffect">å¤šä¸ª useEffect</a></li>
    </ul>
  </li>
  <li><a href="#fetch-data-with-effect-hook" id="markdown-toc-fetch-data-with-effect-hook">Fetch Data with Effect Hook</a>    <ul>
      <li><a href="#ç®€å•è·å–æ•°æ®" id="markdown-toc-ç®€å•è·å–æ•°æ®">ç®€å•è·å–æ•°æ®</a></li>
      <li><a href="#è¾“å…¥idè·å–ä¸åŒæ•°æ®" id="markdown-toc-è¾“å…¥idè·å–ä¸åŒæ•°æ®">è¾“å…¥idè·å–ä¸åŒæ•°æ®</a></li>
      <li><a href="#button-ç‚¹å‡»è§¦å‘-effect" id="markdown-toc-button-ç‚¹å‡»è§¦å‘-effect">button ç‚¹å‡»è§¦å‘ effect</a></li>
    </ul>
  </li>
  <li><a href="#å°ç»“" id="markdown-toc-å°ç»“">å°ç»“</a></li>
</ul>

<p>æŒæ¡ React Hooks api å°†æ›´å¥½çš„å¸®åŠ©ä½ åœ¨å·¥ä½œä¸­ä½¿ç”¨ï¼Œå¯¹ React çš„æŒæ¡æ›´ä¸Šä¸€å±‚æ¥¼ã€‚æœ¬ç³»åˆ—å°†ä½¿ç”¨å¤§é‡å®ä¾‹ä»£ç å’Œæ•ˆæœå±•ç¤ºï¼Œéå¸¸æ˜“äºåˆå­¦è€…å’Œå¤ä¹ ä½¿ç”¨ã€‚</p>

<p>ä»Šå¤©æˆ‘ä»¬è®²è®² useEffect çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>

<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-useeffect">ä¸ºä»€ä¹ˆä½¿ç”¨ useEffect</h2>

<h3 id="ç”Ÿå‘½å‘¨æœŸä¸­å†™é€»è¾‘çš„é—®é¢˜">ç”Ÿå‘½å‘¨æœŸä¸­å†™é€»è¾‘çš„é—®é¢˜</h3>

<p>react ä¸­æ—§çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä¼šæœ‰å‰¯ä½œç”¨ï¼Œæ¯”å¦‚é¡µé¢çš„ title è¦å±•ç¤ºç‚¹å‡»æ¬¡æ•°æ—¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
<span class="p">}</span>
<span class="nx">componentDidUpdate</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åœ¨ componentDidMount å’Œ componentDidUpdate ä¸­éƒ½å†™äº†åŒæ ·çš„ä»£ç ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­æŒ‚è½½ä¸€æ¬¡ï¼Œè¿™å°±å¯¼è‡´äº†ä»£ç é‡å¤çš„é—®é¢˜ã€‚</p>

<p>å¦ä¸€ä¸ªä¾‹å­ï¼Œé¡µé¢ä¸­åŒ…å«äº†å€’è®¡æ—¶ï¼Œå¹¶ä¸”åœ¨é¡µé¢é”€æ¯æ—¶è¦æ¸…é™¤å€’è®¡æ—¶ timer</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¦‚æœè¿™ä¸ªç»„ä»¶æ¯”è¾ƒå¤æ‚ï¼ŒåŒæ—¶åŒ…å«äº†ä¸Šè¿°çš„ä¸¤ç§é€»è¾‘ï¼Œé‚£ä¹ˆä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">componentDidUpdate</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
<span class="p">}</span>
<span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬çœ‹åˆ°2ä¸ªé—®é¢˜</p>

<ol>
  <li>ä»£ç é‡å¤ã€‚è®¾ç½®æ ‡é¢˜çš„ä»£ç é‡å¤äº†1é</li>
  <li>ä»£ç åˆ†æ•£ã€‚é€»è¾‘çœ‹èµ·æ¥å°±åˆ†æ•£åœ¨äº†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªåœ°æ–¹</li>
</ol>

<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¥½çš„æ–¹æ³•è§£å†³</p>

<h3 id="useeffect-è§£å†³çš„é—®é¢˜">useEffect è§£å†³çš„é—®é¢˜</h3>

<ul>
  <li>EffectHook ç”¨äºå‡½æ•°å¼ç»„ä»¶ä¸­å‰¯ä½œç”¨ï¼Œæ‰§è¡Œä¸€äº›ç›¸å…³çš„æ“ä½œï¼Œè§£å†³ä¸Šè¿°çš„é—®é¢˜</li>
  <li>å¯ä»¥è®¤ä¸ºæ˜¯ componentDidMount, componentDidUpdate, componentWillUnmount çš„æ›¿ä»£å“</li>
</ul>

<p>æ¥ä¸‹æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨ useEffectã€‚</p>

<h2 id="useeffect-after-render-çš„ä½¿ç”¨">useEffect After Render çš„ä½¿ç”¨</h2>

<p>ä¸¾ä¸ªä¾‹å­ï¼Œé€šè¿‡ä¸€ä¸ªç‚¹å‡»æŒ‰é’®ï¼Œä¿®æ”¹é¡µé¢ title çš„ä¾‹å­æ¥è¯´æ˜</p>

<h3 id="class-ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹">Class ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹</h3>

<p>7ClassCounter.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">class</span> <span class="nx">ClassCounter</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">count</span><span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
  <span class="p">}</span>
  <span class="nx">componentDidUpdate</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="na">count</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="p">})</span>
        <span class="p">}</span><span class="si">}</span><span class="p">&gt;</span>
          Clicked <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="si">}</span> times
        <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">ClassCounter</span>
</code></pre></div></div>

<p>App.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">ClassCounter</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./components/7ClassCounter</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"App"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">ClassCounter</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span>

</code></pre></div></div>

<p>æ•ˆæœå¦‚ä¸‹</p>

<p><img src="https://gw.alicdn.com/tfs/TB1yhhavy_1gK0jSZFqXXcpaXXa-418-215.gif" alt="" /></p>

<h3 id="ä½¿ç”¨-useeffect-æ”¹å†™ä¸Šè¿°ç¤ºä¾‹">ä½¿ç”¨ useEffect æ”¹å†™ä¸Šè¿°ç¤ºä¾‹</h3>

<p>æ¥ä¸‹æ¥ä½¿ç”¨å‡½æ•°æ—¶ç»„ä»¶å®ç°ä¸Šè¿°çš„ä¾‹å­</p>

<p>7HookCounter.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">HookCounter</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
  <span class="p">})</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setCount</span><span class="p">(</span><span class="nx">prevCount</span> <span class="o">=&gt;</span> <span class="nx">prevCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">}</span><span class="si">}</span> <span class="p">&gt;</span>Clicked <span class="si">{</span><span class="nx">count</span><span class="si">}</span> times<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">HookCounter</span>
</code></pre></div></div>

<p>æ•ˆæœå’Œ Class ç»„ä»¶ç›¸åŒ</p>

<p><img src="https://gw.alicdn.com/tfs/TB1yhhavy_1gK0jSZFqXXcpaXXa-418-215.gif" alt="" /></p>

<p>å¯ä»¥çœ‹åˆ° useEffect çš„ç¬¬ä¸€ä¸ªå…¥å‚æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå®ƒä¼šåœ¨æ¯æ¬¡ render åè°ƒç”¨ã€‚åœ¨ç¬¬ä¸€æ¬¡ render å’Œåç»­çš„æ›´æ–° render éƒ½ä¼šè¢«è°ƒç”¨ã€‚</p>

<p>å¦å¤–ï¼ŒuseEffect å†™åœ¨å‡½æ•°å¼ç»„ä»¶å†…ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥æ‹¿åˆ° props å’Œ state çš„å€¼ï¼Œä¸ç”¨å†™ this ä¹‹ç±»çš„ä»£ç ã€‚</p>

<h2 id="æœ‰æ¡ä»¶åœ°æ‰§è¡Œ-useeffect">æœ‰æ¡ä»¶åœ°æ‰§è¡Œ useEffect</h2>

<p>ä¸Šä¸€èŠ‚äº†è§£åˆ° useEffect ä¼šåœ¨æ¯æ¬¡ render åæ‰§è¡Œé‡Œé¢çš„å‡½æ•°ï¼Œè¿™å¯èƒ½ä¼šæœ‰ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œæ¥ä¸‹æ¥å°±è®²ä¸€è®²å¦‚ä½•æœ‰æ¡ä»¶åœ°æ‰§è¡Œ useEffect ä¸­çš„åŒ¿åå‡½æ•°ã€‚</p>

<p>åœ¨ä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä¸Šè¿›è¡Œæ‰©å±•ä¸€ä¸ªè¾“å…¥ name çš„åŠŸèƒ½ï¼Œé€šè¿‡åˆ¤æ–­åªæ‰§è¡Œ count å˜åŒ–å¸¦æ¥çš„é€»è¾‘ã€‚</p>

<h3 id="class-ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹-1">Class ç»„ä»¶çš„å†™æ³•ç¤ºä¾‹</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kr">interface</span> <span class="nx">stateType</span> <span class="p">{</span>
  <span class="nl">count</span><span class="p">:</span> <span class="nx">number</span>
  <span class="nx">name</span><span class="p">:</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">ClassCounter</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
  <span class="p">}</span>

  <span class="nx">componentDidUpdate</span><span class="p">(</span><span class="nx">prevProps</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">prevState</span><span class="p">:</span> <span class="nx">stateType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">prevState</span><span class="p">.</span><span class="nx">count</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Update title</span><span class="dl">'</span><span class="p">)</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span>
          <span class="na">type</span><span class="p">=</span><span class="s">"text"</span>
          <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>
          <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
              <span class="na">name</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>
            <span class="p">})</span>
          <span class="p">}</span><span class="si">}</span>
        <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="na">count</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="p">})</span>
        <span class="p">}</span><span class="si">}</span><span class="p">&gt;</span>
          Clicked <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="si">}</span> times
        <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">ClassCounter</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/tfs/TB1aX7.voz1gK0jSZLeXXb9kVXa-610-312.gif" alt="" /></p>

<p>ä¸ºäº†æ›´å¥½çš„æ€§èƒ½ï¼Œæ³¨æ„ä»£ç ä¸­åˆ¤æ–­äº† prevState</p>

<h3 id="useeffect-çš„å†™æ³•">useEffect çš„å†™æ³•</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">HookCounter</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">setName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">useEffect - update title</span><span class="dl">'</span><span class="p">)</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">`You clicked </span><span class="p">${</span><span class="nx">count</span><span class="p">}</span><span class="s2"> times`</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">count</span><span class="p">])</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">input</span>
        <span class="na">type</span><span class="p">=</span><span class="s">"text"</span>
        <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span>
        <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">setName</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">}</span><span class="si">}</span>
      <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setCount</span><span class="p">(</span><span class="nx">prevCount</span> <span class="o">=&gt;</span> <span class="nx">prevCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">}</span><span class="si">}</span> <span class="p">&gt;</span>Clicked <span class="si">{</span><span class="nx">count</span><span class="si">}</span> times<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">HookCounter</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/tfs/TB1efJbvAY2gK0jSZFgXXc5OFXa-610-312.gif" alt="" /></p>

<p>æ³¨æ„åˆ° useEffect çš„ç¬¬äºŒä¸ªå‚æ•° <code class="language-plaintext highlighter-rouge">[count]</code>ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…ƒç´ æ˜¯è¦è¢«è§‚å¯Ÿçš„ state æˆ– propsï¼Œåªæœ‰æŒ‡å®šçš„è¿™ä¸ªå˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šè§¦å‘ useEffect ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°åŒ¿åå‡½æ•°çš„æ‰§è¡Œã€‚è¿™æœ‰åˆ©äºæ€§èƒ½çš„ä¿è¯ã€‚</p>

<h2 id="åªæ‰§è¡Œ1æ¬¡-useeffect">åªæ‰§è¡Œ1æ¬¡ useEffect</h2>

<p>æœ¬èŠ‚é€šè¿‡ä¸€ä¸ªè®°å½•é¼ æ ‡åæ ‡çš„ç¤ºä¾‹ç ”ç©¶ä¸€ä¸‹å¦‚ä½•åªæ‰§è¡Œä¸€æ¬¡ useEffect</p>

<h3 id="è®°å½•é¼ æ ‡ä½ç½®ç¤ºä¾‹-class-å†™æ³•">è®°å½•é¼ æ ‡ä½ç½®ç¤ºä¾‹ Class å†™æ³•</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">class</span> <span class="nx">RunEffectsOnlyOnce</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">y</span><span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>

  <span class="nx">logMousePos</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">:</span> <span class="nx">MouseEvent</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="na">x</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
      <span class="na">y</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">logMousePos</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        Y - <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span>, X - <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">RunEffectsOnlyOnce</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/tfs/TB1ydpavET1gK0jSZFrXXcNCXXa-295-225.gif" alt="" /></p>

<p>è¿™é‡Œåªåœ¨ componentDidMount ä¸­åšäº†äº‹ä»¶ç»‘å®šï¼Œåªæ‰§è¡Œäº†ä¸€æ¬¡äº‹ä»¶ç»‘å®š</p>

<h3 id="useeffect-ä¸­è®°å½•é¼ æ ‡åæ ‡">useEffect ä¸­è®°å½•é¼ æ ‡åæ ‡</h3>

<p>ä¸Šè¿°æ•ˆæœæ”¹é€ ä¸ºå‡½æ•°å¼ç»„ä»¶</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">RunEffectsOnlyOnce</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">const</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">setX</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">y</span><span class="p">,</span> <span class="nx">setY</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">logMousePos</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">:</span> <span class="nx">MouseEvent</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setX</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">)</span>
    <span class="nx">setY</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">addEventListener</span><span class="dl">'</span><span class="p">)</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">logMousePos</span><span class="p">)</span>
  <span class="p">},</span> <span class="p">[])</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      Y - <span class="si">{</span><span class="nx">y</span><span class="si">}</span>, X - <span class="si">{</span><span class="nx">x</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">RunEffectsOnlyOnce</span>
</code></pre></div></div>

<p>æ³¨æ„åˆ° useEffect æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ï¼Œæœ‰æ•ˆçš„é¿å…äº†å¤šæ¬¡è°ƒç”¨çš„é—®é¢˜ã€‚</p>

<blockquote>
  <p>å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™å°±å‘Šè¯‰ React ä½ çš„ effect ä¸ä¾èµ–äº props æˆ– state ä¸­çš„ä»»ä½•å€¼ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œéƒ½ä¸éœ€è¦é‡å¤æ‰§è¡Œã€‚è¿™å¹¶ä¸å±äºç‰¹æ®Šæƒ…å†µ â€”â€” å®ƒä¾ç„¶éµå¾ªä¾èµ–æ•°ç»„çš„å·¥ä½œæ–¹å¼ã€‚</p>

  <p>å¦‚æœä½ ä¼ å…¥äº†ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ï¼Œeffect å†…éƒ¨çš„ props å’Œ state å°±ä¼šä¸€ç›´æ‹¥æœ‰å…¶åˆå§‹å€¼ã€‚å°½ç®¡ä¼ å…¥ [] ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æ›´æ¥è¿‘å¤§å®¶æ›´ç†Ÿæ‚‰çš„ <code class="language-plaintext highlighter-rouge">componentDidMount</code> å’Œ <code class="language-plaintext highlighter-rouge">componentWillUnmount</code> æ€ç»´æ¨¡å¼ï¼Œä½†æˆ‘ä»¬æœ‰æ›´å¥½çš„æ–¹å¼æ¥é¿å…è¿‡äºé¢‘ç¹çš„é‡å¤è°ƒç”¨ effectã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯·è®°å¾— React ä¼šç­‰å¾…æµè§ˆå™¨å®Œæˆç”»é¢æ¸²æŸ“ä¹‹åæ‰ä¼šå»¶è¿Ÿè°ƒç”¨ <code class="language-plaintext highlighter-rouge">useEffect</code>ï¼Œå› æ­¤ä¼šä½¿å¾—é¢å¤–æ“ä½œå¾ˆæ–¹ä¾¿ã€‚</p>
</blockquote>

<h2 id="éœ€è¦æ¸…é™¤çš„-effect">éœ€è¦æ¸…é™¤çš„ Effect</h2>

<p>æœ¬èŠ‚ç ”ç©¶å¦‚ä½•å®ç° willUnmount è¿™ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå®ç°ç»„ä»¶é”€æ¯æ—¶ï¼Œæ¸…é™¤ effect é€»è¾‘ã€‚</p>

<p>åœ¨ä¸Šä¸€ä¸ªdemoä¸­å¢åŠ ä¸€ä¸ªé€»è¾‘ï¼Œç‚¹å‡»æŒ‰é’®å±•ç¤ºæˆ–éšè—é¼ æ ‡çš„åæ ‡ç»„ä»¶ã€‚</p>

<h3 id="æ˜¾ç¤ºä¸ç§»é™¤ç»„ä»¶">æ˜¾ç¤ºä¸ç§»é™¤ç»„ä»¶</h3>

<p>å…±ä¸‰ä¸ªæ–‡ä»¶ï¼Œç»“æ„å¦‚ä¸‹</p>

<p><img src="https://gw.alicdn.com/tfs/TB1R_pPFHY1gK0jSZTEXXXDQVXa-309-277.png" alt="" /></p>

<!-- ``` plantuml

skinparam style strictuml

App -- MouseContainer
MouseContainer -- MousePos

``` -->

<p>App.tsx</p>
<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">MouseContainer</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./components/10MouseContainer</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"App"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">MouseContainer</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span>

</code></pre></div></div>

<p>MouseContainer.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">RunEffectsOnlyOnce</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./9RunEffectsOnlyOnce</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">MouseContainer</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">display</span><span class="p">,</span> <span class="nx">setDisplay</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">setDisplay</span><span class="p">(</span><span class="o">!</span><span class="nx">display</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>Toggle display<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">display</span> <span class="o">&amp;&amp;</span> <span class="p">&lt;</span><span class="nc">RunEffectsOnlyOnce</span> <span class="p">/&gt;</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">MouseContainer</span>
</code></pre></div></div>

<p>MousePos</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">RunEffectsOnlyOnce</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">const</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">setX</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">y</span><span class="p">,</span> <span class="nx">setY</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">logMousePos</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">:</span> <span class="nx">MouseEvent</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setX</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">)</span>
    <span class="nx">setY</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">addEventListener</span><span class="dl">'</span><span class="p">)</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">logMousePos</span><span class="p">)</span>
  <span class="p">},</span> <span class="p">[])</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      Y - <span class="si">{</span><span class="nx">y</span><span class="si">}</span>, X - <span class="si">{</span><span class="nx">x</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">RunEffectsOnlyOnce</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/tfs/TB1nYXavEH1gK0jSZSyXXXtlpXa-579-284.gif" alt="" /></p>

<p>æ‰§è¡Œåå‘ç°éšè—äº†ä½ç½®ç»„ä»¶åï¼Œæœ‰ä¸€ä¸ªé”™è¯¯è­¦å‘Šã€‚è¿™æ˜¯å› ä¸ºæ²¡æœ‰æ­£ç¡®å¸è½½å­ç»„ä»¶å¯¼è‡´çš„ã€‚mousemove äº‹ä»¶ä¾ç„¶è¢«ç›‘å¬ç€å’Œæ‰§è¡Œã€‚å¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p>

<h3 id="componentwillunmount">componentWillUnmount</h3>

<p>å› æ­¤è¦åœ¨å¸è½½ç»„ä»¶æ—¶ï¼Œç¡®ä¿æ‰€æœ‰çš„ç›‘å¬å’Œè®¢é˜…éƒ½å·²ç»è¢«ç§»é™¤ã€‚è‹¥æ˜¯åœ¨ Class ç»„ä»¶ä¸­ï¼Œå¯ä»¥å¦‚ä¸‹ä»£ç </p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">logMousePos</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä½†æ˜¯åœ¨ useEffect è¯¥å¦‚ä½•å†™å‘¢ï¼Ÿè¯·å¾€ä¸‹çœ‹</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">addEventListener</span><span class="dl">'</span><span class="p">)</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">logMousePos</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">logMousePos</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[])</span>
</code></pre></div></div>

<p>åœ¨ useEffect çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸­æ·»åŠ ä¸€ä¸ª return åŒ¿åå‡½æ•°ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°å°†åœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬åœ¨è¿™é‡Œç§»é™¤ç›‘å¬å°±å¥½äº†ã€‚</p>

<p><img src="https://gw.alicdn.com/tfs/TB1eAcBvX67gK0jSZPfXXahhFXa-579-284.gif" alt="" /></p>

<p>å¦‚æœéœ€è¦ä¸€äº›åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…é™¤åŠŸèƒ½çš„ä»£ç ï¼Œå°±å†™åœ¨ useEffect ç¬¬ä¸€ä¸ªå‚æ•°çš„è¿”å›åŒ¿åå‡½æ•°ä¸­å§ã€‚</p>

<h2 id="useeffect-ä¸­ä¾èµ–é”™è¯¯å¯¼è‡´çš„-bug">useEffect ä¸­ä¾èµ–é”™è¯¯å¯¼è‡´çš„ bug</h2>

<p>useEffect çš„ä¾èµ–(ç¬¬äºŒä¸ªå‚æ•°)é”™è¯¯å¯¼è‡´çš„é—®é¢˜ã€‚</p>

<p>ä»¥æ¯ç§’ +1 çš„è®¡æ•°å™¨ä¸ºç¤ºä¾‹</p>

<h3 id="class-ç»„ä»¶ç¤ºä¾‹">Class ç»„ä»¶ç¤ºä¾‹</h3>

<p>11Counter.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * æ¯ç§’ +1 çš„è®¡æ•°å™¨
 */</span>

<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">class</span> <span class="nx">Counter</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">count</span><span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>

  <span class="nl">timer</span><span class="p">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">undefined</span>

  <span class="nx">tick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="na">count</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">)</span>
  <span class="p">}</span>


  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">Counter</span>

</code></pre></div></div>

<p>App.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">IntervalCounter</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./components/11Counter</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"App"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">IntervalCounter</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span>

</code></pre></div></div>

<p>æ‰§è¡Œæ²¡æœ‰é—®é¢˜ï¼Œæ•ˆæœå¦‚ä¸‹</p>

<p><img src="https://gw.alicdn.com/tfs/TB1CiNxx9f2gK0jSZFPXXXsopXa-487-270.gif" alt="" /></p>

<h3 id="hooks-ç¤ºä¾‹">hooks ç¤ºä¾‹</h3>

<p>IntervalCounterHooks.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nx">IntervalCouterHooks</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">tick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">tick</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[])</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">count</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">IntervalCouterHooks</span>

</code></pre></div></div>

<p>App.tsx</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">IntervalCounter</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./components/11Counter</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">IntervalCounterHooks</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./components/11IntervalCouterHooks</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"App"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">IntervalCounter</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">IntervalCounterHooks</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span>

</code></pre></div></div>

<p>ä½†æ˜¯è®¡æ•°å™¨æ²¡æœ‰æ­£å¸¸å·¥ä½œï¼Œæ•ˆæœå¦‚ä¸‹</p>

<p><img src="https://gw.alicdn.com/tfs/TB13TdBx7T2gK0jSZPcXXcKkpXa-425-270.gif" alt="" /></p>

<p>ä¼ å…¥ç©ºçš„ä¾èµ–æ•°ç»„ <code class="language-plaintext highlighter-rouge">[]</code>ï¼Œæ„å‘³ç€è¯¥ hook åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶è¿è¡Œä¸€æ¬¡ï¼Œå¹¶éé‡æ–°æ¸²æŸ“æ—¶ã€‚ä½†å¦‚æ­¤ä¼šæœ‰é—®é¢˜ï¼Œåœ¨ <code class="language-plaintext highlighter-rouge">setInterval</code> <code class="language-plaintext highlighter-rouge">çš„å›è°ƒä¸­ï¼Œcount</code> çš„å€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚å› ä¸ºå½“ effect æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼Œå¹¶å°† <code class="language-plaintext highlighter-rouge">count</code> çš„å€¼è¢«ä¿å­˜åœ¨è¯¥é—­åŒ…å½“ä¸­ï¼Œä¸”åˆå€¼ä¸º 0ã€‚æ¯éš”ä¸€ç§’ï¼Œå›è°ƒå°±ä¼šæ‰§è¡Œ <code class="language-plaintext highlighter-rouge">setCount(0 + 1)</code>ï¼Œå› æ­¤ï¼Œ<code class="language-plaintext highlighter-rouge">count</code> æ°¸è¿œä¸ä¼šè¶…è¿‡ 1ã€‚</p>

<p>è§£æ³•ä¸€ï¼šè¿™é‡Œæˆ‘ä»¬ä¸èƒ½å°† useEffect çš„ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºç©ºæ•°ç»„ï¼Œè€Œæ˜¯ <code class="language-plaintext highlighter-rouge">[count]</code>ã€‚</p>

<p>æŒ‡å®š <code class="language-plaintext highlighter-rouge">[count]</code> ä½œä¸ºä¾èµ–åˆ—è¡¨å°±èƒ½ä¿®å¤è¿™ä¸ª Bugï¼Œä½†ä¼šå¯¼è‡´æ¯æ¬¡æ”¹å˜å‘ç”Ÿæ—¶å®šæ—¶å™¨éƒ½è¢«é‡ç½®ã€‚äº‹å®ä¸Šï¼Œæ¯ä¸ª <code class="language-plaintext highlighter-rouge">setInterval</code> åœ¨è¢«æ¸…é™¤å‰ï¼ˆç±»ä¼¼äº setTimeoutï¼‰éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ã€‚ä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ setState çš„å‡½æ•°å¼æ›´æ–°å½¢å¼ã€‚å®ƒå…è®¸æˆ‘ä»¬æŒ‡å®š state è¯¥å¦‚ä½•æ”¹å˜è€Œä¸ç”¨å¼•ç”¨å½“å‰ stateï¼Œå³ä¸‹é¢çš„è§£æ³•äºŒ</p>

<p>è§£æ³•äºŒï¼š</p>

<p>å°†</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>æ”¹ä¸º</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">setCount</span><span class="p">((</span><span class="nx">preCount</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="nx">preCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>useEffect çš„ä¾èµ–æ•°ç»„é‡Œä¾ç„¶ä½¿ç”¨ç©ºæ•°ç»„ã€‚è¿™é‡Œè®¾ç½®äº† count çš„å€¼æ˜¯å’Œä¸Šä¸€ä¸ªå€¼æœ‰å…³ï¼Œä¹Ÿè§£å†³äº†é—®é¢˜ã€‚æ­¤æ—¶ï¼Œ<code class="language-plaintext highlighter-rouge">setInterval</code> çš„å›è°ƒä¾æ—§æ¯ç§’è°ƒç”¨ä¸€æ¬¡ï¼Œä½†æ¯æ¬¡ setCount å†…éƒ¨çš„å›è°ƒå–åˆ°çš„ <code class="language-plaintext highlighter-rouge">count</code> æ˜¯æœ€æ–°å€¼ï¼ˆåœ¨å›è°ƒä¸­å˜é‡å‘½åä¸º cï¼‰ã€‚</p>

<p><img src="https://gw.alicdn.com/tfs/TB1eq1qAeT2gK0jSZFvXXXnFXXa-433-292.gif" alt="" /></p>

<h3 id="å¤šä¸ª-useeffect">å¤šä¸ª useEffect</h3>

<p>å¦‚æœä»£ç ä¸­æœ‰å¤šä¸ªä¸šåŠ¡é€»è¾‘ï¼Œå¯ä»¥å°†ä»–ä»¬å†™åœ¨ä¸åŒçš„ useEffect ä¸­ï¼Œå¹¶ä¸”å¯ä»¥å†™å¤šä¸ª useState å’Œä»–ä»¬åŒ¹é…åˆ†ç»„ä½¿ç”¨ï¼Œä¼šè®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚</p>

<h2 id="fetch-data-with-effect-hook">Fetch Data with Effect Hook</h2>

<h3 id="ç®€å•è·å–æ•°æ®">ç®€å•è·å–æ•°æ®</h3>

<p>æœ¬èŠ‚è®²è¿°ä½¿ç”¨ useEffect æ¥è·å–æ•°æ®ï¼Œæœ¬æ–‡ä½¿ç”¨ axios åº“ç¤ºä¾‹ã€‚</p>

<p>https://jsonplaceholder.typicode.com/ ç½‘ç«™æä¾›äº†ç¤ºä¾‹çš„è¯·æ±‚ï¼Œè¿”å›äº†ä¸€äº› json æ•°æ®ã€‚</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span>

<span class="kr">interface</span> <span class="nx">postType</span> <span class="p">{</span>
  <span class="nl">userId</span><span class="p">:</span> <span class="nx">number</span>
  <span class="nx">id</span><span class="p">:</span> <span class="nx">number</span>
  <span class="nx">title</span><span class="p">:</span> <span class="nx">string</span>
  <span class="nx">body</span><span class="p">:</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">FetchData</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">const</span> <span class="p">[</span><span class="nx">posts</span><span class="p">,</span> <span class="nx">setPosts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">postType</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">([])</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="na">data</span><span class="p">:</span> <span class="nx">postType</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="nx">setPosts</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">rej</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">rej</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">},</span> <span class="p">[])</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="si">{</span>
          <span class="nx">posts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
            <span class="p">&lt;</span><span class="nt">li</span>
              <span class="na">key</span><span class="p">=</span><span class="si">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span>
            <span class="p">&gt;</span>
              <span class="si">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">))</span>
        <span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">FetchData</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/tfs/TB1UAWCAlr0gK0jSZFnXXbRRXXa-802-814.jpg" alt="" /></p>

<p>è¿™é‡Œæ³¨æ„ ts åœ¨ useState ä¸­çš„å†™æ³•ã€‚</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span><span class="nx">posts</span><span class="p">,</span> <span class="nx">setPosts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">postType</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">([])</span>
</code></pre></div></div>

<p>æ³¨æ„ useEffect ç¬¬äºŒä¸ªä¾èµ–å‚æ•°ä¼ å…¥ç©ºæ•°ç»„ï¼Œä¿è¯äº† useEffect åªæ‰§è¡Œä¸€æ¬¡ã€‚</p>

<h3 id="è¾“å…¥idè·å–ä¸åŒæ•°æ®">è¾“å…¥idè·å–ä¸åŒæ•°æ®</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span>

<span class="kr">interface</span> <span class="nx">postType</span> <span class="p">{</span>
  <span class="nl">userId</span><span class="p">:</span> <span class="nx">number</span>
  <span class="nx">id</span><span class="p">:</span> <span class="nx">number</span>
  <span class="nx">title</span><span class="p">:</span> <span class="nx">string</span>
  <span class="nx">body</span><span class="p">:</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">FetchData</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">post</span><span class="p">,</span> <span class="nx">setPost</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">postType</span><span class="o">&gt;</span><span class="p">()</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">id</span><span class="p">,</span> <span class="nx">setId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">)</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">`https://jsonplaceholder.typicode.com/posts/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="na">data</span><span class="p">:</span> <span class="nx">postType</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="nx">setPost</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">id</span><span class="p">])</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">input</span>
        <span class="na">type</span><span class="p">=</span><span class="s">"text"</span>
        <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">id</span><span class="si">}</span>
        <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">setId</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">}</span><span class="si">}</span>
      <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="si">{</span>
          <span class="nx">post</span> <span class="o">&amp;&amp;</span> <span class="nx">post</span><span class="p">.</span><span class="nx">title</span>
        <span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">FetchData</span>

</code></pre></div></div>

<p><img src="https://gw.alicdn.com/tfs/TB1wvCvAXP7gK0jSZFjXXc5aXXa-432-292.gif" alt="" /></p>

<h3 id="button-ç‚¹å‡»è§¦å‘-effect">button ç‚¹å‡»è§¦å‘ effect</h3>

<p>ç›‘å¬æŒ‰é’®ç‚¹å‡»è§¦å‘å˜åŒ–ï¼Œæ‰§è¡Œ effect æ–¹æ³•</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span>

<span class="kr">interface</span> <span class="nx">postType</span> <span class="p">{</span>
  <span class="nl">userId</span><span class="p">:</span> <span class="nx">number</span>
  <span class="nx">id</span><span class="p">:</span> <span class="nx">number</span>
  <span class="nx">title</span><span class="p">:</span> <span class="nx">string</span>
  <span class="nx">body</span><span class="p">:</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">FetchData</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">post</span><span class="p">,</span> <span class="nx">setPost</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">postType</span><span class="o">&gt;</span><span class="p">()</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">id</span><span class="p">,</span> <span class="nx">setId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">idFromBtnClick</span><span class="p">,</span> <span class="nx">setIdFromBtnClick</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">)</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">idFromBtnClick</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">`https://jsonplaceholder.typicode.com/posts/</span><span class="p">${</span><span class="nx">idFromBtnClick</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="na">data</span><span class="p">:</span> <span class="nx">postType</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="nx">setPost</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">idFromBtnClick</span><span class="p">])</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">input</span>
        <span class="na">type</span><span class="p">=</span><span class="s">"text"</span>
        <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">id</span><span class="si">}</span>
        <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">setId</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">}</span><span class="si">}</span>
      <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span>
        <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">setIdFromBtnClick</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
        <span class="p">}</span><span class="si">}</span>
      <span class="p">&gt;</span>Fetch Post<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="si">{</span>
          <span class="nx">post</span> <span class="o">&amp;&amp;</span> <span class="nx">post</span><span class="p">.</span><span class="nx">title</span>
        <span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">FetchData</span>
</code></pre></div></div>

<p><img src="https://gw.alicdn.com/tfs/TB1sH2tAi_1gK0jSZFqXXcpaXXa-432-292.gif" alt="" /></p>

<h2 id="å°ç»“">å°ç»“</h2>

<p>æœ¬ç« ä»ä¸ºä»€ä¹ˆä½¿ç”¨ useEffect å¼€å§‹è¯´èµ·ï¼Œç”¨æˆ·è§£å†³ä»£ç é‡å¤ä»£ç åˆ†æ•£çš„é—®é¢˜ï¼ŒuseEffect å¯ä»¥æ›´å¥½çš„ç»„ç»‡ä»£ç ã€‚</p>

<p>useEffect api çš„ç”¨æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºåŒ¿åå‡½æ•°ï¼Œä½œä¸º effect è¦æ‰§è¡Œçš„å†…å®¹ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ•°ç»„ï¼Œç”¨äºè§‚å¯Ÿæ”¹å˜çš„ props æˆ– state è¿›è¡Œæœ‰æ¡ä»¶çš„è§¦å‘ effectï¼Œæˆ–è€…ä¼ å…¥ç©ºæ•°ç»„ï¼Œè®© effect åªæ‰§è¡Œä¸€æ¬¡ã€‚useEffect è¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œåœ¨ç»„ä»¶é”€æ¯æ˜¯æ‰§è¡Œï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å†…å­˜æ³„éœ²çš„é£é™©ã€‚</p>

<p>æœ€åä¸¾äº†å‡ ä¸ªä¾‹å­æ¥å±•ç¤ºå¦‚ä½•åœ¨ useEffect ä¸­æ‰§è¡Œå‘èµ·è¯·æ±‚è·å–æ•°æ®çš„é€»è¾‘ã€‚ä¸‹ä¸€ç« å°†è®²è¿° useContext è¿™ä¸ª apiã€‚</p>
:ET